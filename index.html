<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم مدیریت کارمندان - شعبه مرکزی تبریز</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN warning in console
        if (typeof console !== 'undefined' && console.warn) {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0] && typeof args[0] === 'string' && args[0].includes('should not be used in production')) {
                    return;
                }
                originalWarn.apply(console, args);
            };
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap');
        
        * { 
            font-family: 'Vazirmatn', sans-serif; 
        }
        
        /* Modern Gradients */
        .gradient-primary { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        .gradient-secondary { 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
        }
        .gradient-success { 
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
        }
        .gradient-warning { 
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); 
        }
        .gradient-info { 
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); 
        }
        .gradient-light { 
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); 
        }
        
        /* Glass Morphism */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Advanced Shadows */
        .shadow-elegant {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .shadow-luxury {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .shadow-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }
        
        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .animate-slideInRight {
            animation: slideInRight 0.6s ease-out;
        }
        
        .animate-pulse-custom {
            animation: pulse 2s infinite;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Hover Effects */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .hover-glow {
            transition: all 0.3s ease;
        }
        
        .hover-glow:hover {
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
            transform: scale(1.02);
        }
        
        /* Sidebar Styles */
        .sidebar-item {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .sidebar-item:hover::before {
            left: 100%;
        }
        
        .sidebar-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            transform: translateX(-5px);
            border-right: 4px solid #667eea;
        }
        
        /* Card Styles */
        .metric-card {
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }
        
        .metric-card:hover::before {
            opacity: 1;
            top: -100%;
            left: -100%;
        }
        
        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        /* Table Styles */
        .table-row {
            transition: all 0.3s ease;
        }
        
        .table-row:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            transform: scale(1.01);
        }
        
        /* Form Styles */
        .form-input {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        /* Loading Animation */
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status Indicators */
        .status-online {
            position: relative;
        }
        
        .status-online::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid white;
            animation: pulse 2s infinite;
        }
        
        /* Progress Bars */
        .progress-bar {
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 1s ease-in-out;
        }
        
        /* Notification Styles */
        .notification {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-left: 4px solid #667eea;
            animation: slideInRight 0.5s ease-out;
        }
        
        /* Dark Mode Support */
        .dark .glass {
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar-item {
                padding: 0.75rem;
            }
            
            .metric-card {
                margin-bottom: 1rem;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }
        
        /* Financial Ticker Styles */
        .animate-marquee {
            animation: marquee 120s linear infinite;
        }
        
        .animate-marquee:hover {
            animation-play-state: paused;
        }
        
        @keyframes marquee {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        
        .ticker-item {
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 0.75rem;
        }
        
        .ticker-item:hover {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transform: scale(1.05);
        }
        
        /* Ticker number animation */
        .ticker-number {
            transition: all 0.5s ease;
        }
        
        .ticker-number.updating {
            animation: numberUpdate 0.5s ease-in-out;
        }
        
        @keyframes numberUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); color: #fbbf24; }
            100% { transform: scale(1); }
        }
        
        /* Ticker collapsed state */
        .ticker-collapsed {
            height: 4px !important;
            overflow: hidden;
        }
        
        .ticker-collapsed .animate-marquee {
            display: none;
        }
        
        /* Ticker glow effect */
        .ticker-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        /* Responsive ticker */
        @media (max-width: 768px) {
            .animate-marquee {
                animation-duration: 40s;
            }
            
            .ticker-item {
                padding: 0.25rem;
            }
            
            .ticker-item .text-lg {
                font-size: 1rem;
            }
            
            .ticker-item .text-xs {
                font-size: 0.625rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center relative overflow-hidden">
        <!-- Animated Background Elements -->
        <div class="absolute inset-0 overflow-hidden">
            <!-- Geometric Shapes -->
            <div class="absolute top-20 right-20 w-32 h-32 bg-blue-400/10 rounded-full animate-float"></div>
            <div class="absolute bottom-32 left-16 w-48 h-48 bg-indigo-400/10 rounded-full animate-float" style="animation-delay: 2s;"></div>
            <div class="absolute top-1/3 left-1/4 w-24 h-24 bg-purple-400/10 rounded-full animate-pulse-custom"></div>
            
            <!-- Grid Pattern -->
            <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
            
            <!-- Floating Icons -->
            <div class="absolute top-1/4 right-1/3 text-white/10 text-4xl animate-float">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="absolute bottom-1/4 left-1/3 text-white/10 text-3xl animate-float" style="animation-delay: 1.5s;">
                <i class="fas fa-users"></i>
            </div>
        </div>
        
        <!-- Main Login Card -->
        <div class="relative z-10 w-full max-w-lg mx-4">
            <!-- Bank Logo and Header -->
            <div class="text-center mb-8">
                <div class="relative inline-block">
                    <div class="w-24 h-24 bg-gradient-to-br from-green-600 to-emerald-700 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-2xl transform rotate-3 hover:rotate-0 transition-transform duration-500">
                        <svg class="w-14 h-14 text-white" viewBox="0 0 100 100" fill="currentColor">
                            <!-- Bank Shahr Logo -->
                            <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="3"/>
                            <path d="M25 35 L50 20 L75 35 L75 45 L25 45 Z" fill="currentColor"/>
                            <rect x="30" y="45" width="8" height="25" fill="currentColor"/>
                            <rect x="42" y="45" width="8" height="25" fill="currentColor"/>
                            <rect x="54" y="45" width="8" height="25" fill="currentColor"/>
                            <rect x="66" y="45" width="8" height="25" fill="currentColor"/>
                            <rect x="25" y="70" width="50" height="5" fill="currentColor"/>
                            <circle cx="50" cy="30" r="3" fill="currentColor"/>
                            <text x="50" y="85" text-anchor="middle" font-size="8" fill="currentColor">شهر</text>
                        </svg>
                    </div>
                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full border-4 border-white animate-pulse"></div>
                </div>
                <h1 class="text-4xl font-bold text-white mb-3 tracking-wide">بانک شهر</h1>
                <div class="flex items-center justify-center space-x-4 space-x-reverse mb-4">
                    <div class="h-px bg-gradient-to-r from-transparent via-white/50 to-transparent flex-1"></div>
                    <p class="text-white/90 text-lg font-medium px-4">سیستم مدیریت کارمندان</p>
                    <div class="h-px bg-gradient-to-r from-transparent via-white/50 to-transparent flex-1"></div>
                </div>
                <div class="bg-white/10 backdrop-blur-sm rounded-full px-6 py-2 inline-block">
                    <p class="text-white/80 text-sm">شعبه مرکزی تبریز - کد ۳۶۴</p>
                </div>
            </div>
            
            <!-- Login Form Card -->
            <div class="bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 p-8 animate-fadeInUp">
                <form id="loginForm" class="space-y-6">
                    <!-- Username Field -->
                    <div class="space-y-3">
                        <label class="block text-sm font-bold text-white/90 tracking-wide">نام کاربری</label>
                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/20 to-indigo-500/20 rounded-xl blur opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative">
                                <i class="fas fa-user absolute right-4 top-1/2 transform -translate-y-1/2 text-white/60 group-focus-within:text-white transition-colors"></i>
                                <input type="text" id="username" class="form-input w-full pr-12 pl-4 py-4 bg-white/10 border-2 border-white/20 rounded-xl text-white placeholder-white/50 focus:bg-white/20 focus:border-white/40 focus:outline-none transition-all duration-300" placeholder="نام کاربری خود را وارد کنید" autocomplete="username">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Password Field -->
                    <div class="space-y-3">
                        <label class="block text-sm font-bold text-white/90 tracking-wide">رمز عبور</label>
                        <div class="relative group">
                            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/20 to-indigo-500/20 rounded-xl blur opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative">
                                <i class="fas fa-lock absolute right-4 top-1/2 transform -translate-y-1/2 text-white/60 group-focus-within:text-white transition-colors"></i>
                                <input type="password" id="password" class="form-input w-full pr-12 pl-4 py-4 bg-white/10 border-2 border-white/20 rounded-xl text-white placeholder-white/50 focus:bg-white/20 focus:border-white/40 focus:outline-none transition-all duration-300" placeholder="رمز عبور خود را وارد کنید" autocomplete="current-password">
                                <button type="button" onclick="togglePassword()" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white/60 hover:text-white transition-colors">
                                    <i class="fas fa-eye" id="passwordToggle"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Login Button -->
                    <div class="pt-4">
                        <button type="submit" class="relative w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 rounded-xl text-white font-bold text-lg shadow-2xl transform hover:scale-105 transition-all duration-300 overflow-hidden group">
                            <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-white/0 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
                            <div class="relative flex items-center justify-center space-x-3 space-x-reverse">
                                <i class="fas fa-sign-in-alt"></i>
                                <span>ورود به سیستم</span>
                            </div>
                        </button>
                    </div>
                </form>
                
                <!-- Login Credentials Info -->
                <div class="mt-8 pt-6 border-t border-white/20">
                    <div class="bg-blue-500/20 rounded-xl p-4">
                        <h4 class="text-white font-bold mb-3 flex items-center">
                            <i class="fas fa-info-circle ml-2"></i>
                            اطلاعات ورود
                        </h4>
                        <div class="space-y-2 text-sm text-white/80">
                            <div class="flex justify-between items-center">
                                <span>مدیر سیستم:</span>
                                <code class="bg-white/20 px-2 py-1 rounded text-white">admin / admin</code>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>کارمندان:</span>
                                <span>کد پرسنلی / کد ملی</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="text-center mt-8">
                <p class="text-white/60 text-sm">
                    © ۱۴۰۳ بانک شهر - تمامی حقوق محفوظ است
                </p>
                <div class="flex items-center justify-center space-x-4 space-x-reverse mt-4">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-white/60 text-xs">سیستم آنلاین و فعال</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Ticker Display -->
    <div id="financialTicker" class="fixed top-0 left-0 right-0 z-40 bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 text-white shadow-2xl border-b-4 border-yellow-400" style="display: none;">
        <div class="relative overflow-hidden h-16">
            <!-- Animated Background Pattern -->
            <div class="absolute inset-0 opacity-10">
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-transparent via-white to-transparent transform -skew-x-12 animate-pulse"></div>
            </div>
            
            <!-- Ticker Content -->
            <div class="relative h-full flex items-center">
                <div class="flex items-center space-x-8 space-x-reverse animate-marquee whitespace-nowrap">
                    <!-- Bank Logo -->
                    <div class="flex items-center space-x-3 space-x-reverse bg-white/10 px-6 py-2 rounded-full backdrop-blur-sm">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-university text-white text-sm"></i>
                        </div>
                        <span class="font-bold text-lg">بانک شهر تبریز</span>
                    </div>
                    
                    <!-- Financial Metrics -->
                    <div class="flex items-center space-x-12 space-x-reverse">
                        <!-- Daily Resources -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('dailyResources')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center group-hover:bg-blue-500/30 transition-all">
                                    <i class="fas fa-coins text-blue-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-blue-200 font-medium">منابع روز</div>
                                    <div class="text-lg font-bold" id="tickerDailyResources">2,450,000,000</div>
                                </div>
                                <div class="text-green-400 text-sm font-medium">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span id="tickerDailyResourcesChange">+12.5%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Resource Target -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('resourceTarget')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center group-hover:bg-green-500/30 transition-all">
                                    <i class="fas fa-bullseye text-green-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-green-200 font-medium">هدف منابع</div>
                                    <div class="text-lg font-bold" id="tickerResourceTarget">3,000,000,000</div>
                                </div>
                                <div class="text-yellow-400 text-sm font-medium">
                                    <span id="tickerResourceProgress">81.7%</span>
                                    <i class="fas fa-target mr-1"></i>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profit & Loss -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('profitLoss')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-purple-500/20 rounded-full flex items-center justify-center group-hover:bg-purple-500/30 transition-all">
                                    <i class="fas fa-chart-line text-purple-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-purple-200 font-medium">سود و زیان</div>
                                    <div class="text-lg font-bold" id="tickerProfitLoss">+185,000,000</div>
                                </div>
                                <div class="text-green-400 text-sm font-medium">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span id="tickerProfitLossChange">+8.2%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expenses -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('expenses')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-red-500/20 rounded-full flex items-center justify-center group-hover:bg-red-500/30 transition-all">
                                    <i class="fas fa-money-bill-wave text-red-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-red-200 font-medium">مصارف</div>
                                    <div class="text-lg font-bold" id="tickerExpenses">1,265,000,000</div>
                                </div>
                                <div class="text-red-400 text-sm font-medium">
                                    <i class="fas fa-arrow-down mr-1"></i>
                                    <span id="tickerExpensesChange">-3.1%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Claims -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('claims')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-orange-500/20 rounded-full flex items-center justify-center group-hover:bg-orange-500/30 transition-all">
                                    <i class="fas fa-file-invoice-dollar text-orange-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-orange-200 font-medium">مطالبات</div>
                                    <div class="text-lg font-bold" id="tickerClaims">890,000,000</div>
                                </div>
                                <div class="text-orange-400 text-sm font-medium">
                                    <i class="fas fa-minus mr-1"></i>
                                    <span id="tickerClaimsChange">-1.5%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Deposits -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('deposits')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-cyan-500/20 rounded-full flex items-center justify-center group-hover:bg-cyan-500/30 transition-all">
                                    <i class="fas fa-piggy-bank text-cyan-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-cyan-200 font-medium">سپرده‌ها</div>
                                    <div class="text-lg font-bold" id="tickerDeposits">4,120,000,000</div>
                                </div>
                                <div class="text-green-400 text-sm font-medium">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span id="tickerDepositsChange">+15.8%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Facilities -->
                        <div class="ticker-item group cursor-pointer" onclick="showTickerEditModal('facilities')">
                            <div class="flex items-center space-x-3 space-x-reverse">
                                <div class="w-10 h-10 bg-indigo-500/20 rounded-full flex items-center justify-center group-hover:bg-indigo-500/30 transition-all">
                                    <i class="fas fa-hand-holding-usd text-indigo-300 text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-xs text-indigo-200 font-medium">تسهیلات</div>
                                    <div class="text-lg font-bold" id="tickerFacilities">1,850,000,000</div>
                                </div>
                                <div class="text-green-400 text-sm font-medium">
                                    <i class="fas fa-arrow-up mr-1"></i>
                                    <span id="tickerFacilitiesChange">+6.7%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Status -->
                    <div class="flex items-center space-x-3 space-x-reverse bg-green-500/20 px-4 py-2 rounded-full backdrop-blur-sm">
                        <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse shadow-lg"></div>
                        <span class="text-green-200 font-medium text-sm">زنده</span>
                        <span class="text-green-100 text-xs" id="tickerTime"></span>
                    </div>
                    
                    <!-- Duplicate content for seamless loop -->
                    <div class="flex items-center space-x-8 space-x-reverse">
                        <div class="flex items-center space-x-3 space-x-reverse bg-white/10 px-6 py-2 rounded-full backdrop-blur-sm">
                            <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-emerald-500 rounded-lg flex items-center justify-center">
                                <i class="fas fa-university text-white text-sm"></i>
                            </div>
                            <span class="font-bold text-lg">بانک شهر تبریز</span>
                        </div>
                        
                        <div class="flex items-center space-x-12 space-x-reverse">
                            <div class="ticker-item">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center">
                                        <i class="fas fa-coins text-blue-300 text-lg"></i>
                                    </div>
                                    <div>
                                        <div class="text-xs text-blue-200 font-medium">منابع روز</div>
                                        <div class="text-lg font-bold">2,450,000,000</div>
                                    </div>
                                    <div class="text-green-400 text-sm font-medium">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span>+12.5%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Toggle Button -->
            <button onclick="toggleTicker()" class="absolute left-4 top-1/2 transform -translate-y-1/2 w-8 h-8 bg-white/20 hover:bg-white/30 rounded-full flex items-center justify-center transition-all backdrop-blur-sm">
                <i class="fas fa-chevron-up text-white text-sm" id="tickerToggleIcon"></i>
            </button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;" class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
        <!-- Enhanced Header -->
        <header class="bg-white/80 backdrop-blur-xl sticky top-0 z-50 border-b border-gray-200/50 shadow-xl">
            <div class="flex items-center justify-between px-8 py-5">
                <div class="flex items-center space-x-6 space-x-reverse">
                    <div class="relative">
                        <div class="gradient-primary w-16 h-16 rounded-2xl flex items-center justify-center shadow-2xl transform rotate-3 hover:rotate-0 transition-all duration-500">
                            <i class="fas fa-crown text-white text-2xl"></i>
                        </div>
                        <div class="absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-4 border-white animate-pulse shadow-lg"></div>
                    </div>
                    <div>
                        <h2 class="font-bold text-gray-800 text-2xl">مدیر ارشد سیستم</h2>
                        <p class="text-gray-600 flex items-center mt-1">
                            <i class="fas fa-map-marker-alt ml-2 text-blue-500"></i>
                            شعبه مرکزی تبریز - کد ۳۶۴
                        </p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-6 space-x-reverse">
                    <!-- Notifications -->
                    <div class="relative">
                        <button class="relative p-3 bg-gray-100 hover:bg-gray-200 rounded-xl transition-all hover:scale-110">
                            <i class="fas fa-bell text-gray-600"></i>
                            <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                        </button>
                    </div>
                    
                    <!-- Status -->
                    <div class="flex items-center space-x-3 space-x-reverse bg-gradient-to-r from-green-100 to-emerald-100 px-6 py-3 rounded-2xl shadow-lg">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse shadow-lg"></div>
                        <span class="text-green-700 font-bold">آنلاین و فعال</span>
                        <i class="fas fa-wifi text-green-600"></i>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="relative">
                        <button onclick="toggleUserMenu()" class="flex items-center space-x-3 space-x-reverse bg-white px-4 py-3 rounded-2xl shadow-lg hover:shadow-xl transition-all">
                            <div class="w-10 h-10 gradient-primary rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-gray-800 text-sm">مدیر سیستم</p>
                                <p class="text-gray-500 text-xs">دسترسی کامل</p>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400"></i>
                        </button>
                        
                        <!-- User Dropdown -->
                        <div id="userMenu" class="hidden absolute left-0 mt-2 w-64 bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden">
                            <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50">
                                <p class="font-bold text-gray-800">مدیر سیستم</p>
                                <p class="text-sm text-gray-600">admin@bankshahr.ir</p>
                            </div>
                            <div class="p-2">
                                <button class="w-full text-right px-4 py-3 hover:bg-gray-50 rounded-xl transition-all flex items-center">
                                    <i class="fas fa-user-cog ml-3 text-blue-500"></i>
                                    تنظیمات حساب
                                </button>
                                <button class="w-full text-right px-4 py-3 hover:bg-gray-50 rounded-xl transition-all flex items-center">
                                    <i class="fas fa-key ml-3 text-green-500"></i>
                                    تغییر رمز عبور
                                </button>
                                <button onclick="logout()" class="w-full text-right px-4 py-3 hover:bg-red-50 rounded-xl transition-all flex items-center text-red-600">
                                    <i class="fas fa-sign-out-alt ml-3"></i>
                                    خروج از سیستم
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex min-h-screen">
            <!-- Enhanced Sidebar -->
            <aside class="w-80 bg-gradient-to-b from-slate-900 via-blue-900 to-indigo-900 shadow-2xl relative overflow-hidden">
                <!-- Background Pattern -->
                <div class="absolute inset-0 opacity-10">
                    <div class="absolute top-10 right-10 w-32 h-32 bg-white rounded-full"></div>
                    <div class="absolute bottom-20 left-10 w-24 h-24 bg-white rounded-full"></div>
                    <div class="absolute top-1/2 left-1/2 w-16 h-16 bg-white rounded-full transform -translate-x-1/2 -translate-y-1/2"></div>
                </div>
                
                <div class="relative z-10 p-8">
                    <!-- Logo Section -->
                    <div class="text-center mb-12">
                        <div class="relative inline-block">
                            <div class="gradient-primary w-20 h-20 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl transform hover:scale-110 transition-all duration-500">
                                <i class="fas fa-chart-network text-white text-3xl"></i>
                            </div>
                            <div class="absolute -top-2 -right-2 w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center shadow-lg">
                                <i class="fas fa-star text-white text-sm"></i>
                            </div>
                        </div>
                        <h3 class="text-white font-bold text-xl mb-2">پنل مدیریت پیشرفته</h3>
                        <p class="text-white/70 text-sm">سیستم جامع مدیریت کارمندان</p>
                    </div>
                    
                    <!-- Navigation Menu -->
                    <nav class="space-y-3">
                        <div class="text-white/50 text-xs font-bold uppercase tracking-wider mb-4 px-4">منوی اصلی</div>
                        
                        <button onclick="showSection('overview')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-tachometer-alt text-blue-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">داشبورد اصلی</p>
                                    <p class="text-xs text-white/60">نمای کلی سیستم</p>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="showSection('employees')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-users text-green-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">مدیریت کارمندان</p>
                                    <p class="text-xs text-white/60">افزودن، حذف، ویرایش</p>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="showSection('departments')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-building text-purple-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">مدیریت بخش‌ها</p>
                                    <p class="text-xs text-white/60">تخصیص و سازماندهی</p>
                                </div>
                            </div>
                        </button>
                        
                        <div class="text-white/50 text-xs font-bold uppercase tracking-wider mb-4 px-4 mt-8">ابزارهای پیشرفته</div>
                        
                        <button onclick="showSection('goals')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-bullseye text-red-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">اهداف و شاخص‌ها</p>
                                    <p class="text-xs text-white/60">تعریف و پیگیری</p>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="showSection('reports')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-chart-bar text-yellow-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">گزارش‌گیری</p>
                                    <p class="text-xs text-white/60">تحلیل و آمار</p>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="showSection('marketing')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-bullhorn text-pink-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">مدیریت بازاریابی</p>
                                    <p class="text-xs text-white/60">مشتریان و فعالیت‌ها</p>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="showSection('evaluation')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-clipboard-check text-indigo-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">ارزیابی کارمندان</p>
                                    <p class="text-xs text-white/60">نمره‌دهی و پیگیری</p>
                                </div>
                            </div>
                        </button>
                        
                        <button onclick="showSection('import')" class="sidebar-item w-full text-right px-6 py-4 rounded-2xl text-white/90 hover:text-white font-medium transition-all duration-300 group">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center ml-4 group-hover:bg-white/20 transition-all">
                                    <i class="fas fa-file-import text-orange-400 text-lg"></i>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">بارگزاری اکسل</p>
                                    <p class="text-xs text-white/60">وارد کردن داده‌ها</p>
                                </div>
                            </div>
                        </button>
                    </nav>
                    
                    <!-- Footer Info -->
                    <div class="mt-12 p-6 bg-white/10 rounded-2xl backdrop-blur-sm">
                        <div class="flex items-center space-x-3 space-x-reverse mb-3">
                            <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                            <span class="text-white/80 text-sm font-medium">سیستم فعال</span>
                        </div>
                        <p class="text-white/60 text-xs">آخرین بروزرسانی: <span id="lastUpdateSidebar"></span></p>
                        <p class="text-white/60 text-xs mt-1">نسخه ۲.۱.۰</p>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-8">
                <!-- Overview Section -->
                <div id="overviewSection" class="section" style="display: block;">
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-4xl font-bold text-gray-800 mb-2 animate-fadeInUp">داشبورد مدیریت</h1>
                            <p class="text-gray-600 animate-fadeInUp" style="animation-delay: 0.1s;">نمای کلی عملکرد سازمان</p>
                        </div>
                        <div class="flex items-center space-x-4 space-x-reverse">
                            <div class="glass rounded-xl px-4 py-2 animate-slideInRight">
                                <span class="text-sm text-gray-600">آخرین بروزرسانی:</span>
                                <span class="text-sm font-semibold text-gray-800 mr-2" id="lastUpdate"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Metrics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                        <div class="metric-card gradient-secondary text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">بازاریابی</p>
                                    <p class="text-3xl font-bold mt-2" id="marketingCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">کارمند فعال</p>
                                </div>
                                <div class="gradient-light w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-bullhorn text-2xl text-gray-700"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-success text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.1s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">وصول مطالبات</p>
                                    <p class="text-3xl font-bold mt-2" id="collectionCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">کارمند فعال</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-money-bill-wave text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-warning text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">پایانه فروشگاهی</p>
                                    <p class="text-3xl font-bold mt-2" id="posCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">کارمند فعال</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-credit-card text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-info text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.3s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">خدمات مدرن</p>
                                    <p class="text-3xl font-bold mt-2" id="modernCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">کارمند فعال</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-laptop text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card glass text-gray-800 p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.4s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">کاربرگ ارزیابی</p>
                                    <p class="text-3xl font-bold mt-2" id="evaluationCount">0</p>
                                    <p class="text-gray-500 text-xs mt-1">کارمند فعال</p>
                                </div>
                                <div class="gradient-primary w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clipboard-check text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Analytics -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <div class="lg:col-span-2 glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.5s;">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">عملکرد ماهانه بخش‌ها</h3>
                                <div class="flex space-x-2 space-x-reverse">
                                    <button class="w-3 h-3 bg-red-500 rounded-full"></button>
                                    <button class="w-3 h-3 bg-yellow-500 rounded-full"></button>
                                    <button class="w-3 h-3 bg-green-500 rounded-full"></button>
                                </div>
                            </div>
                            <canvas id="monthlyChart" class="w-full h-64"></canvas>
                        </div>
                        
                        <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.6s;">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">توزیع کارمندان</h3>
                            <canvas id="employeeChart" class="w-full h-64"></canvas>
                        </div>
                    </div>

                    <!-- Real-time Activities -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.7s;">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">فعالیت‌های لحظه‌ای</h3>
                                <div class="flex items-center space-x-2 space-x-reverse">
                                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                    <span class="text-sm text-green-600 font-medium">زنده</span>
                                </div>
                            </div>
                            <div id="realtimeActivity" class="space-y-3 max-h-80 overflow-y-auto">
                                <!-- Real-time activities will be displayed here -->
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.8s;">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">برترین کارمندان</h3>
                            <div id="topPerformers" class="space-y-4">
                                <!-- Top performers will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Employees Section -->
                <div id="employeesSection" class="section" style="display: none;">
                    <!-- Header Section -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="gradient-primary w-16 h-16 rounded-2xl flex items-center justify-center shadow-glow animate-float">
                                    <i class="fas fa-users text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-4xl font-bold text-gray-800 mb-2 animate-fadeInUp">مدیریت کارمندان</h1>
                                    <p class="text-gray-600 animate-fadeInUp" style="animation-delay: 0.1s;">مدیریت جامع اطلاعات و عملکرد کارمندان</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="glass rounded-xl px-4 py-2 animate-slideInRight">
                                    <span class="text-sm text-gray-600">تعداد کل:</span>
                                    <span class="text-lg font-bold text-blue-600 mr-2" id="totalEmployeesCount">0</span>
                                </div>
                                <button onclick="showAddEmployeeModal()" class="btn-primary px-8 py-4 rounded-xl text-white font-bold shadow-luxury hover-glow animate-slideInRight" style="animation-delay: 0.1s;">
                                    <i class="fas fa-plus ml-2"></i>
                                    افزودن کارمند جدید
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="metric-card gradient-primary text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">کل کارمندان</p>
                                    <p class="text-3xl font-bold mt-2" id="statsTotal">0</p>
                                    <p class="text-white/70 text-xs mt-1">نفر فعال</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-users text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-success text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.1s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">مدیران بخش</p>
                                    <p class="text-3xl font-bold mt-2" id="statsManagers">0</p>
                                    <p class="text-white/70 text-xs mt-1">مسئول</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-tie text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-warning text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">کارمندان فعال</p>
                                    <p class="text-3xl font-bold mt-2" id="statsActive">0</p>
                                    <p class="text-white/70 text-xs mt-1">در بخش‌ها</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-check text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-info text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.3s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">جدیدترین عضو</p>
                                    <p class="text-lg font-bold mt-2" id="statsNewest">-</p>
                                    <p class="text-white/70 text-xs mt-1">امروز</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-plus text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filter Section -->
                    <div class="glass rounded-2xl p-6 shadow-elegant mb-8 animate-fadeInUp" style="animation-delay: 0.4s;">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                            <div class="relative">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                                <input type="text" id="employeeSearch" placeholder="جستجو در کارمندان..." class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onkeyup="filterEmployees()">
                            </div>
                            <div>
                                <select id="departmentFilter" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterEmployees()">
                                    <option value="">همه بخش‌ها</option>
                                    <option value="marketing">بازاریابی</option>
                                    <option value="collection">وصول مطالبات</option>
                                    <option value="pos">پایانه فروشگاهی</option>
                                    <option value="modern">خدمات مدرن</option>
                                    <option value="evaluation">کاربرگ ارزیابی</option>
                                </select>
                            </div>
                            <div>
                                <select id="positionFilter" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onchange="filterEmployees()">
                                    <option value="">همه سمت‌ها</option>
                                    <option value="مدیر">مدیر</option>
                                    <option value="کارشناس">کارشناس</option>
                                    <option value="کارشناس ارشد">کارشناس ارشد</option>
                                </select>
                            </div>
                            <div class="flex space-x-3 space-x-reverse">
                                <button onclick="exportEmployees('excel')" class="gradient-warning text-white px-6 py-3 rounded-xl hover-glow font-semibold flex-1">
                                    <i class="fas fa-file-excel ml-2"></i>
                                    اکسل
                                </button>
                                <button onclick="exportEmployees('pdf')" class="gradient-secondary text-white px-6 py-3 rounded-xl hover-glow font-semibold flex-1">
                                    <i class="fas fa-file-pdf ml-2"></i>
                                    PDF
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Employees Table -->
                    <div class="glass rounded-2xl shadow-elegant overflow-hidden animate-fadeInUp" style="animation-delay: 0.5s;">
                        <div class="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-white flex items-center">
                                    <i class="fas fa-table ml-3"></i>
                                    لیست کارمندان
                                </h3>
                                <div class="flex items-center space-x-3 space-x-reverse text-white/80 text-sm">
                                    <span>نمایش:</span>
                                    <select id="recordsPerPage" class="bg-white/20 border border-white/30 rounded-lg px-3 py-1 text-white" onchange="updateTablePagination()">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100">همه</option>
                                    </select>
                                    <span>رکورد</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700 cursor-pointer hover:bg-gray-100 transition-colors" onclick="sortTable('name')">
                                            <div class="flex items-center justify-between">
                                                <span>نام و نام خانوادگی</span>
                                                <i class="fas fa-sort text-gray-400"></i>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700 cursor-pointer hover:bg-gray-100 transition-colors" onclick="sortTable('code')">
                                            <div class="flex items-center justify-between">
                                                <span>کد پرسنلی</span>
                                                <i class="fas fa-sort text-gray-400"></i>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">کد ملی</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700 cursor-pointer hover:bg-gray-100 transition-colors" onclick="sortTable('joinDate')">
                                            <div class="flex items-center justify-between">
                                                <span>تاریخ ورود</span>
                                                <i class="fas fa-sort text-gray-400"></i>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">سمت</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">بخش مسئول</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">وضعیت</th>
                                        <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">عملیات</th>
                                    </tr>
                                </thead>
                                <tbody id="employeesTable" class="divide-y divide-gray-200 bg-white">
                                    <!-- Employee rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-gray-700">
                                    نمایش <span id="recordsInfo">1-10 از 0</span> رکورد
                                </div>
                                <div class="flex items-center space-x-2 space-x-reverse" id="paginationControls">
                                    <!-- Pagination buttons will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Departments Section -->
                <div id="departmentsSection" class="section" style="display: none;">
                    <!-- Header Section -->
                    <div class="mb-10">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="gradient-primary w-16 h-16 rounded-3xl flex items-center justify-center shadow-2xl animate-float">
                                    <i class="fas fa-sitemap text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-4xl font-bold text-gray-800 mb-2 animate-fadeInUp">مدیریت بخش‌ها</h1>
                                    <p class="text-gray-600 animate-fadeInUp" style="animation-delay: 0.1s;">سازماندهی و تخصیص کارمندان به بخش‌های مختلف</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="bg-white rounded-2xl px-6 py-3 shadow-lg">
                                    <span class="text-sm text-gray-600">کل بخش‌ها:</span>
                                    <span class="text-2xl font-bold text-blue-600 mr-2">5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Department Cards Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 mb-10">
                        <!-- Marketing Department -->
                        <div class="bg-white rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 border border-gray-100 hover:border-blue-200 group">
                            <div class="flex items-center justify-between mb-8">
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="gradient-secondary w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-all">
                                        <i class="fas fa-bullhorn text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">بازاریابی</h3>
                                        <p class="text-gray-500 text-sm">Marketing Department</p>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-blue-600" id="marketingCount">0</div>
                                    <div class="text-xs text-gray-500">کارمند</div>
                                </div>
                            </div>
                            
                            <!-- Manager Selection -->
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center">
                                    <i class="fas fa-user-tie ml-2 text-blue-500"></i>
                                    مسئول بخش
                                </label>
                                <div class="relative">
                                    <select class="form-input w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 transition-all" id="marketingManager">
                                        <option value="">انتخاب مسئول بخش</option>
                                    </select>
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Employees Management -->
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-sm font-bold text-gray-700 flex items-center">
                                        <i class="fas fa-users ml-2 text-green-500"></i>
                                        کارمندان بخش
                                    </label>
                                    <button onclick="showAddEmployeeToDepartment('marketing')" class="text-blue-600 hover:text-blue-800 text-sm font-medium hover:bg-blue-50 px-3 py-1 rounded-lg transition-all">
                                        <i class="fas fa-plus ml-1"></i>
                                        افزودن
                                    </button>
                                </div>
                                <div id="marketingEmployeesList" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Employees will be listed here -->
                                </div>
                            </div>
                            
                            <!-- Department Stats -->
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-4">
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div class="text-lg font-bold text-blue-600" id="marketingActiveCount">0</div>
                                        <div class="text-xs text-gray-600">فعال</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-green-600" id="marketingPerformance">85%</div>
                                        <div class="text-xs text-gray-600">عملکرد</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Collection Department -->
                        <div class="bg-white rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 border border-gray-100 hover:border-green-200 group">
                            <div class="flex items-center justify-between mb-8">
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="gradient-success w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-all">
                                        <i class="fas fa-money-bill-wave text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">وصول مطالبات</h3>
                                        <p class="text-gray-500 text-sm">Collection Department</p>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-green-600" id="collectionCount">0</div>
                                    <div class="text-xs text-gray-500">کارمند</div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center">
                                    <i class="fas fa-user-tie ml-2 text-blue-500"></i>
                                    مسئول بخش
                                </label>
                                <div class="relative">
                                    <select class="form-input w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:border-green-500 focus:ring-4 focus:ring-green-100 transition-all" id="collectionManager">
                                        <option value="">انتخاب مسئول بخش</option>
                                    </select>
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-sm font-bold text-gray-700 flex items-center">
                                        <i class="fas fa-users ml-2 text-green-500"></i>
                                        کارمندان بخش
                                    </label>
                                    <button onclick="showAddEmployeeToDepartment('collection')" class="text-green-600 hover:text-green-800 text-sm font-medium hover:bg-green-50 px-3 py-1 rounded-lg transition-all">
                                        <i class="fas fa-plus ml-1"></i>
                                        افزودن
                                    </button>
                                </div>
                                <div id="collectionEmployeesList" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Employees will be listed here -->
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-4">
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div class="text-lg font-bold text-green-600" id="collectionActiveCount">0</div>
                                        <div class="text-xs text-gray-600">فعال</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-blue-600" id="collectionPerformance">92%</div>
                                        <div class="text-xs text-gray-600">عملکرد</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- POS Department -->
                        <div class="bg-white rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 border border-gray-100 hover:border-yellow-200 group">
                            <div class="flex items-center justify-between mb-8">
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="gradient-warning w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-all">
                                        <i class="fas fa-credit-card text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">پایانه فروشگاهی</h3>
                                        <p class="text-gray-500 text-sm">POS Department</p>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-yellow-600" id="posCount">0</div>
                                    <div class="text-xs text-gray-500">کارمند</div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center">
                                    <i class="fas fa-user-tie ml-2 text-blue-500"></i>
                                    مسئول بخش
                                </label>
                                <div class="relative">
                                    <select class="form-input w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:border-yellow-500 focus:ring-4 focus:ring-yellow-100 transition-all" id="posManager">
                                        <option value="">انتخاب مسئول بخش</option>
                                    </select>
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-sm font-bold text-gray-700 flex items-center">
                                        <i class="fas fa-users ml-2 text-green-500"></i>
                                        کارمندان بخش
                                    </label>
                                    <button onclick="showAddEmployeeToDepartment('pos')" class="text-yellow-600 hover:text-yellow-800 text-sm font-medium hover:bg-yellow-50 px-3 py-1 rounded-lg transition-all">
                                        <i class="fas fa-plus ml-1"></i>
                                        افزودن
                                    </button>
                                </div>
                                <div id="posEmployeesList" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Employees will be listed here -->
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-4">
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div class="text-lg font-bold text-yellow-600" id="posActiveCount">0</div>
                                        <div class="text-xs text-gray-600">فعال</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-orange-600" id="posPerformance">78%</div>
                                        <div class="text-xs text-gray-600">عملکرد</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Modern Services Department -->
                        <div class="bg-white rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 border border-gray-100 hover:border-purple-200 group">
                            <div class="flex items-center justify-between mb-8">
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="gradient-info w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-all">
                                        <i class="fas fa-laptop text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">خدمات مدرن</h3>
                                        <p class="text-gray-500 text-sm">Modern Services</p>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-purple-600" id="modernCount">0</div>
                                    <div class="text-xs text-gray-500">کارمند</div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center">
                                    <i class="fas fa-user-tie ml-2 text-blue-500"></i>
                                    مسئول بخش
                                </label>
                                <div class="relative">
                                    <select class="form-input w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:border-purple-500 focus:ring-4 focus:ring-purple-100 transition-all" id="modernManager">
                                        <option value="">انتخاب مسئول بخش</option>
                                    </select>
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-sm font-bold text-gray-700 flex items-center">
                                        <i class="fas fa-users ml-2 text-green-500"></i>
                                        کارمندان بخش
                                    </label>
                                    <button onclick="showAddEmployeeToDepartment('modern')" class="text-purple-600 hover:text-purple-800 text-sm font-medium hover:bg-purple-50 px-3 py-1 rounded-lg transition-all">
                                        <i class="fas fa-plus ml-1"></i>
                                        افزودن
                                    </button>
                                </div>
                                <div id="modernEmployeesList" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Employees will be listed here -->
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-4">
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div class="text-lg font-bold text-purple-600" id="modernActiveCount">0</div>
                                        <div class="text-xs text-gray-600">فعال</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-pink-600" id="modernPerformance">88%</div>
                                        <div class="text-xs text-gray-600">عملکرد</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Evaluation Department -->
                        <div class="bg-white rounded-3xl p-8 shadow-2xl hover:shadow-3xl transition-all duration-500 border border-gray-100 hover:border-indigo-200 group">
                            <div class="flex items-center justify-between mb-8">
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <div class="gradient-primary w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-all">
                                        <i class="fas fa-clipboard-check text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-800">کاربرگ ارزیابی</h3>
                                        <p class="text-gray-500 text-sm">Evaluation Department</p>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-indigo-600" id="evaluationCount">0</div>
                                    <div class="text-xs text-gray-500">کارمند</div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-gray-700 mb-3 flex items-center">
                                    <i class="fas fa-user-tie ml-2 text-blue-500"></i>
                                    مسئول بخش
                                </label>
                                <div class="relative">
                                    <select class="form-input w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition-all" id="evaluationManager">
                                        <option value="">انتخاب مسئول بخش</option>
                                    </select>
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-chevron-down text-gray-400"></i>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-3">
                                    <label class="text-sm font-bold text-gray-700 flex items-center">
                                        <i class="fas fa-users ml-2 text-green-500"></i>
                                        کارمندان بخش
                                    </label>
                                    <button onclick="showAddEmployeeToDepartment('evaluation')" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium hover:bg-indigo-50 px-3 py-1 rounded-lg transition-all">
                                        <i class="fas fa-plus ml-1"></i>
                                        افزودن
                                    </button>
                                </div>
                                <div id="evaluationEmployeesList" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Employees will be listed here -->
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-2xl p-4">
                                <div class="grid grid-cols-2 gap-4 text-center">
                                    <div>
                                        <div class="text-lg font-bold text-indigo-600" id="evaluationActiveCount">0</div>
                                        <div class="text-xs text-gray-600">فعال</div>
                                    </div>
                                    <div>
                                        <div class="text-lg font-bold text-blue-600" id="evaluationPerformance">95%</div>
                                        <div class="text-xs text-gray-600">عملکرد</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center justify-center space-x-6 space-x-reverse">
                        <button onclick="saveDepartmentAssignments()" class="btn-primary px-12 py-5 rounded-2xl text-white font-bold text-lg shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300">
                            <i class="fas fa-save ml-3"></i>
                            ذخیره تمام تخصیص‌ها
                        </button>
                        <button onclick="resetDepartmentAssignments()" class="bg-gray-500 hover:bg-gray-600 px-12 py-5 rounded-2xl text-white font-bold text-lg shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all duration-300">
                            <i class="fas fa-undo ml-3"></i>
                            بازنشانی
                        </button>
                    </div>
                </div>

                <!-- Goals Section -->
                <div id="goalsSection" class="section" style="display: none;">
                    <div class="mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">مدیریت اهداف و شاخص‌ها</h1>
                        <p class="text-gray-600">تعریف و پیگیری اهداف بخش‌های مختلف</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">تعریف اهداف بخش‌ها</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب بخش</label>
                                    <select id="goalDepartment" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                        <option value="marketing">بازاریابی</option>
                                        <option value="collection">وصول مطالبات</option>
                                        <option value="pos">پایانه فروشگاهی</option>
                                        <option value="modern">خدمات مدرن</option>
                                        <option value="evaluation">کاربرگ ارزیابی</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">هدف ماهانه</label>
                                    <input type="number" id="monthlyGoal" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="مقدار هدف ماهانه">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">هدف سالانه</label>
                                    <input type="number" id="yearlyGoal" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="مقدار هدف سالانه">
                                </div>
                                <button onclick="saveGoals()" class="btn-primary w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-save ml-2"></i>
                                    ذخیره اهداف
                                </button>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">تعریف شاخص‌ها</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب بخش</label>
                                    <select id="metricDepartment" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                        <option value="marketing">بازاریابی</option>
                                        <option value="collection">وصول مطالبات</option>
                                        <option value="pos">پایانه فروشگاهی</option>
                                        <option value="modern">خدمات مدرن</option>
                                        <option value="evaluation">کاربرگ ارزیابی</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">نام شاخص</label>
                                    <input type="text" id="metricName" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="نام شاخص">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">مقدار هدف</label>
                                    <input type="number" id="metricTarget" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="مقدار هدف">
                                </div>
                                <button onclick="addMetric()" class="gradient-warning w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-plus ml-2"></i>
                                    افزودن شاخص
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Metrics List -->
                    <div class="glass rounded-2xl shadow-elegant">
                        <div class="p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">شاخص‌های تعریف شده</h3>
                            <div id="metricsList" class="space-y-4">
                                <!-- Metrics will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reportsSection" class="section" style="display: none;">
                    <div class="mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">گزارش‌گیری و تحلیل جامع</h1>
                        <p class="text-gray-600">تولید گزارش‌های تفصیلی و تحلیل عملکرد</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                        <div class="glass rounded-2xl p-6 shadow-elegant hover-lift">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">گزارش بخش‌ها</h3>
                            <select id="reportDepartment" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg mb-4">
                                <option value="all">همه بخش‌ها</option>
                                <option value="marketing">بازاریابی</option>
                                <option value="collection">وصول مطالبات</option>
                                <option value="pos">پایانه فروشگاهی</option>
                                <option value="modern">خدمات مدرن</option>
                                <option value="evaluation">کاربرگ ارزیابی</option>
                            </select>
                            <div class="space-y-3">
                                <button onclick="generateExcelReport()" class="gradient-warning w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-file-excel ml-2"></i>
                                    دانلود اکسل
                                </button>
                                <button onclick="generatePDFReport()" class="gradient-secondary w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-file-pdf ml-2"></i>
                                    دانلود PDF
                                </button>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-elegant hover-lift">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">تحلیل عملکرد فردی</h3>
                            <select id="analysisEmployee" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg mb-4">
                                <option value="">انتخاب کارمند</option>
                            </select>
                            <button onclick="showEmployeeAnalysis()" class="gradient-info w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                <i class="fas fa-chart-line ml-2"></i>
                                نمایش تحلیل
                            </button>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-elegant hover-lift">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">گزارش بازه زمانی</h3>
                            <div class="space-y-3">
                                <input type="date" id="reportStartDate" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <input type="date" id="reportEndDate" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <button onclick="generateTimeReport()" class="btn-primary w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-calendar ml-2"></i>
                                    تولید گزارش
                                </button>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-elegant hover-lift">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">گزارش شاخص‌ها</h3>
                            <select id="reportMetric" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg mb-4">
                                <option value="all">همه شاخص‌ها</option>
                            </select>
                            <button onclick="generateMetricReport()" class="gradient-success w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                <i class="fas fa-chart-bar ml-2"></i>
                                گزارش شاخص
                            </button>
                        </div>
                    </div>

                    <!-- Performance Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">نمودار عملکرد کلی</h3>
                            <canvas id="performanceChart"></canvas>
                        </div>
                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">تحلیل رفتار کارمندان</h3>
                            <canvas id="behaviorChart"></canvas>
                        </div>
                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">مقایسه اهداف و عملکرد</h3>
                            <canvas id="goalsChart"></canvas>
                        </div>
                    </div>

                    <!-- Detailed Reports Table -->
                    <div class="glass rounded-2xl p-6 shadow-elegant">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-800">گزارش تفصیلی عملکرد</h3>
                            <div class="flex space-x-3 space-x-reverse">
                                <button onclick="exportDetailedReport('excel')" class="gradient-warning text-white px-6 py-2 rounded-xl hover-glow font-semibold">
                                    <i class="fas fa-file-excel ml-2"></i>
                                    اکسل
                                </button>
                                <button onclick="exportDetailedReport('pdf')" class="gradient-secondary text-white px-6 py-2 rounded-xl hover-glow font-semibold">
                                    <i class="fas fa-file-pdf ml-2"></i>
                                    PDF
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="gradient-primary text-white">
                                    <tr>
                                        <th class="px-4 py-3 text-right text-sm font-bold">کارمند</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">بخش</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">شاخص</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">هدف</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">انجام شده</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">درصد تحقق</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">وضعیت</th>
                                    </tr>
                                </thead>
                                <tbody id="detailedReportTable" class="divide-y divide-gray-200">
                                    <!-- Detailed report rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Marketing Management Section -->
                <div id="marketingSection" class="section" style="display: none;">
                    <div class="mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">مدیریت بازاریابی</h1>
                        <p class="text-gray-600">مدیریت مشتریان هدف و فعالیت‌های بازاریابی</p>
                    </div>
                    
                    <!-- Customer Management -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <div class="flex justify-between items-center mb-6">
                                <h3 class="text-xl font-bold text-gray-800">مشتریان هدف</h3>
                                <button onclick="showAddCustomerModal()" class="btn-primary px-6 py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-plus ml-2"></i>
                                    افزودن مشتری
                                </button>
                            </div>
                            <div class="space-y-4 max-h-96 overflow-y-auto" id="customersList">
                                <!-- Customers will be displayed here -->
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-6 shadow-elegant">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">تخصیص مشتری به کارمند</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب کارمند بازاریابی</label>
                                    <select id="marketingEmployeeSelect" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                        <option value="">انتخاب کنید</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب مشتری</label>
                                    <select id="customerSelect" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                        <option value="">انتخاب کنید</option>
                                    </select>
                                </div>
                                <button onclick="assignCustomer()" class="gradient-warning w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-user-plus ml-2"></i>
                                    تخصیص مشتری
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Employee Assignments -->
                    <div class="glass rounded-2xl p-6 shadow-elegant mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">تخصیص‌های فعلی</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="gradient-primary text-white">
                                    <tr>
                                        <th class="px-4 py-3 text-right text-sm font-bold">کارمند</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">مشتری</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">نوع</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">حوزه فعالیت</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">آخرین فعالیت</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">عملیات</th>
                                    </tr>
                                </thead>
                                <tbody id="assignmentsTable" class="divide-y divide-gray-200">
                                    <!-- Assignments will be displayed here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Marketing Progress Chart -->
                    <div class="glass rounded-2xl p-6 shadow-elegant mb-8">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">نمودار پیشرفت بازاریابی</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب مشتری برای نمایش پیشرفت</label>
                            <select id="progressCustomerSelect" onchange="updateMarketingProgressChart()" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="">انتخاب کنید</option>
                            </select>
                        </div>
                        <canvas id="marketingProgressChart" class="w-full h-96"></canvas>
                    </div>

                    <!-- Marketing Activities -->
                    <div class="glass rounded-2xl p-6 shadow-elegant">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">فعالیت‌های بازاریابی</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="gradient-primary text-white">
                                    <tr>
                                        <th class="px-4 py-3 text-right text-sm font-bold">کارمند</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">مشتری</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">نوع فعالیت</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">تاریخ</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">وضعیت</th>
                                        <th class="px-4 py-3 text-right text-sm font-bold">جزئیات</th>
                                    </tr>
                                </thead>
                                <tbody id="activitiesTable" class="divide-y divide-gray-200">
                                    <!-- Activities will be displayed here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Employee Evaluation Section -->
                <div id="evaluationSection" class="section" style="display: none;">
                    <!-- Header Section -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="gradient-primary w-16 h-16 rounded-3xl flex items-center justify-center shadow-2xl animate-float">
                                    <i class="fas fa-clipboard-check text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-4xl font-bold text-gray-800 mb-2 animate-fadeInUp">ارزیابی کارمندان</h1>
                                    <p class="text-gray-600 animate-fadeInUp" style="animation-delay: 0.1s;">سیستم جامع نمره‌دهی، تذکرات و پیگیری عملکرد</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4 space-x-reverse">
                                <div class="bg-white rounded-2xl px-6 py-3 shadow-lg">
                                    <span class="text-sm text-gray-600">کل ارزیابی‌ها:</span>
                                    <span class="text-2xl font-bold text-blue-600 mr-2" id="totalEvaluations">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
                        <div class="metric-card gradient-primary text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">کل ارزیابی‌ها</p>
                                    <p class="text-3xl font-bold mt-2" id="totalEvaluationsCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">ثبت شده</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-star text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-success text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.1s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">وظایف فعال</p>
                                    <p class="text-3xl font-bold mt-2" id="activeTasksCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">در حال انجام</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-tasks text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-warning text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">تذکرات</p>
                                    <p class="text-3xl font-bold mt-2" id="totalWarningsCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">ارسال شده</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card gradient-info text-white p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.3s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/80 text-sm font-medium">پیام‌های کاری</p>
                                    <p class="text-3xl font-bold mt-2" id="totalMessagesCount">0</p>
                                    <p class="text-white/70 text-xs mt-1">ارسال شده</p>
                                </div>
                                <div class="bg-white/20 w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-envelope text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="metric-card glass text-gray-800 p-6 rounded-2xl shadow-luxury hover-lift animate-fadeInUp" style="animation-delay: 0.4s;">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">ارزیابی امروز</p>
                                    <p class="text-3xl font-bold mt-2" id="todayEvaluationsCount">0</p>
                                    <p class="text-gray-500 text-xs mt-1">انجام شده</p>
                                </div>
                                <div class="gradient-primary w-16 h-16 rounded-full flex items-center justify-center">
                                    <i class="fas fa-calendar-day text-2xl text-white"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 mb-8">
                        <!-- Employee Selection -->
                        <div class="lg:col-span-1">
                            <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.5s;">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                        <i class="fas fa-users ml-3 text-blue-500"></i>
                                        انتخاب کارمند
                                    </h3>
                                </div>
                                
                                <!-- Search Box -->
                                <div class="relative mb-4">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i class="fas fa-search text-gray-400"></i>
                                    </div>
                                    <input type="text" id="employeeSearchEval" placeholder="جستجو کارمند..." class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" onkeyup="filterEmployeesForEvaluation()">
                                </div>
                                
                                <!-- Employee List -->
                                <div id="employeeListForEvaluation" class="space-y-3 max-h-96 overflow-y-auto">
                                    <!-- Employees will be listed here -->
                                </div>
                            </div>
                        </div>

                        <!-- Selected Employee Info & Actions -->
                        <div class="lg:col-span-1">
                            <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.6s;">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <i class="fas fa-user-check ml-3 text-green-500"></i>
                                    کارمند انتخابی
                                </h3>
                                
                                <div id="selectedEmployeeInfo" class="mb-6">
                                    <div class="text-center py-8 text-gray-500">
                                        <i class="fas fa-user-plus text-4xl text-gray-300 mb-4"></i>
                                        <p>لطفاً یک کارمند انتخاب کنید</p>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="space-y-3">
                                    <button id="scoreBtn" onclick="showScoreModal()" disabled class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold rounded-xl transition-all opacity-50">
                                        <i class="fas fa-star ml-2"></i>
                                        نمره‌دهی
                                    </button>
                                    <button id="warningBtn" onclick="showWarningModal()" disabled class="w-full py-3 px-4 bg-red-600 hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold rounded-xl transition-all opacity-50">
                                        <i class="fas fa-exclamation-triangle ml-2"></i>
                                        ارسال تذکر
                                    </button>
                                    <button id="messageBtn" onclick="showMessageModal()" disabled class="w-full py-3 px-4 bg-green-600 hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold rounded-xl transition-all opacity-50">
                                        <i class="fas fa-envelope ml-2"></i>
                                        پیام کاری
                                    </button>
                                    <button id="taskBtn" onclick="showTaskModal()" disabled class="w-full py-3 px-4 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold rounded-xl transition-all opacity-50">
                                        <i class="fas fa-tasks ml-2"></i>
                                        تعریف وظیفه
                                    </button>
                                    <button id="feedbackBtn" onclick="showFeedbackModal()" disabled class="w-full py-3 px-4 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-semibold rounded-xl transition-all opacity-50">
                                        <i class="fas fa-comment-dots ml-2"></i>
                                        درخواست بازخورد
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Stats & Active Tasks -->
                        <div class="lg:col-span-2">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Active Tasks -->
                                <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.7s;">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-bold text-gray-800 flex items-center">
                                            <i class="fas fa-tasks ml-2 text-purple-500"></i>
                                            وظایف فعال
                                        </h3>
                                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium" id="activeTasksCount">0</span>
                                    </div>
                                    <div id="activeTasksList" class="space-y-3 max-h-64 overflow-y-auto">
                                        <!-- Active tasks will be displayed here -->
                                    </div>
                                </div>

                                <!-- Recent Messages -->
                                <div class="glass rounded-2xl p-6 shadow-elegant animate-fadeInUp" style="animation-delay: 0.8s;">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="text-lg font-bold text-gray-800 flex items-center">
                                            <i class="fas fa-envelope ml-2 text-green-500"></i>
                                            پیام‌های اخیر
                                        </h3>
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium" id="recentMessagesCount">0</span>
                                    </div>
                                    <div id="recentMessagesList" class="space-y-3 max-h-64 overflow-y-auto">
                                        <!-- Recent messages will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluation History Table -->
                    <div class="glass rounded-2xl shadow-elegant overflow-hidden animate-fadeInUp" style="animation-delay: 0.9s;">
                        <div class="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-white flex items-center">
                                    <i class="fas fa-history ml-3"></i>
                                    تاریخچه ارزیابی‌ها
                                </h3>
                                <div class="flex items-center space-x-3 space-x-reverse text-white/80 text-sm">
                                    <span>آخرین فعالیت‌ها</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 border-b border-gray-200">
                                    <tr>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">کارمند</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">نوع ارزیابی</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">وضعیت</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">تاریخ</th>
                                        <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">توضیحات</th>
                                        <th class="px-6 py-4 text-center text-sm font-bold text-gray-700">عملیات</th>
                                    </tr>
                                </thead>
                                <tbody id="evaluationHistoryTable" class="divide-y divide-gray-200 bg-white">
                                    <!-- Evaluation history will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Import Section -->
                <div id="importSection" class="section" style="display: none;">
                    <div class="mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">بارگزاری فایل اکسل</h1>
                        <p class="text-gray-600">وارد کردن اطلاعات از فایل‌های اکسل</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                        <div class="glass rounded-2xl p-8 shadow-elegant hover-lift">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">بارگزاری کارمندان</h3>
                            <div class="border-2 border-dashed border-gray-300 rounded-2xl p-12 text-center hover:border-blue-400 transition-colors">
                                <div class="gradient-primary w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-cloud-upload-alt text-white text-2xl"></i>
                                </div>
                                <p class="text-gray-600 mb-4 font-medium">فایل اکسل کارمندان را اینجا بکشید یا کلیک کنید</p>
                                <input type="file" id="employeeFile" accept=".xlsx,.xls" class="hidden" onchange="handleEmployeeImport(event)">
                                <button onclick="document.getElementById('employeeFile').click()" class="btn-primary px-8 py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-file-upload ml-2"></i>
                                    انتخاب فایل
                                </button>
                            </div>
                        </div>

                        <div class="glass rounded-2xl p-8 shadow-elegant hover-lift">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">بارگزاری اهداف و شاخص‌ها</h3>
                            <div class="border-2 border-dashed border-gray-300 rounded-2xl p-12 text-center hover:border-green-400 transition-colors">
                                <div class="gradient-warning w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-cloud-upload-alt text-white text-2xl"></i>
                                </div>
                                <p class="text-gray-600 mb-4 font-medium">فایل اکسل اهداف را اینجا بکشید یا کلیک کنید</p>
                                <input type="file" id="goalsFile" accept=".xlsx,.xls" class="hidden" onchange="handleGoalsImport(event)">
                                <button onclick="document.getElementById('goalsFile').click()" class="gradient-warning px-8 py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-file-upload ml-2"></i>
                                    انتخاب فایل
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-2xl p-6 shadow-elegant">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">راهنمای فرمت فایل‌ها</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-blue-50 rounded-xl p-6">
                                <h4 class="font-bold text-blue-800 mb-4 flex items-center">
                                    <i class="fas fa-users ml-2"></i>
                                    فرمت فایل کارمندان:
                                </h4>
                                <ul class="text-sm text-blue-700 space-y-2">
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-green-500"></i>ستون A: نام و نام خانوادگی</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-green-500"></i>ستون B: کد پرسنلی</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-green-500"></i>ستون C: کد ملی</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-green-500"></i>ستون D: تاریخ ورود</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-green-500"></i>ستون E: سمت</li>
                                </ul>
                            </div>
                            <div class="bg-green-50 rounded-xl p-6">
                                <h4 class="font-bold text-green-800 mb-4 flex items-center">
                                    <i class="fas fa-target ml-2"></i>
                                    فرمت فایل اهداف:
                                </h4>
                                <ul class="text-sm text-green-700 space-y-2">
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-blue-500"></i>ستون A: نام بخش</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-blue-500"></i>ستون B: نام شاخص</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-blue-500"></i>ستون C: هدف ماهانه</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-blue-500"></i>ستون D: هدف سالانه</li>
                                    <li class="flex items-center"><i class="fas fa-check-circle ml-2 text-blue-500"></i>ستون E: مقدار هدف</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Employee Dashboard -->
    <div id="employeeDashboard" style="display: none;" class="min-h-screen">
        <!-- Header -->
        <header class="glass sticky top-0 z-50 border-b border-white/20">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="gradient-success w-12 h-12 rounded-full flex items-center justify-center shadow-glow status-online">
                        <i class="fas fa-user text-white text-lg"></i>
                    </div>
                    <div>
                        <h2 class="font-bold text-gray-800 text-lg" id="employeeName">کارمند</h2>
                        <p class="text-sm text-gray-600" id="employeeDepartment">بخش</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="flex items-center space-x-2 space-x-reverse bg-green-100 px-4 py-2 rounded-full">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-green-700 text-sm font-medium">فعال</span>
                    </div>
                    
                    <button onclick="logout()" class="gradient-secondary text-white px-6 py-2 rounded-xl hover-lift shadow-elegant">
                        <i class="fas fa-sign-out-alt ml-2"></i>
                        خروج
                    </button>
                </div>
            </div>
        </header>

        <div class="p-8">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">پنل کاربری</h1>
                <p class="text-gray-600">مدیریت اقدامات و فعالیت‌های شخصی</p>
            </div>
            
            <!-- Employee Goals -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="glass rounded-2xl p-6 shadow-elegant">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">اهداف تخصیص داده شده</h3>
                    <div id="employeeGoals" class="space-y-4">
                        <!-- Goals will be displayed here -->
                    </div>
                </div>

                <div class="glass rounded-2xl p-6 shadow-elegant">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">ثبت اقدامات</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب شاخص</label>
                            <select id="actionMetric" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="">انتخاب کنید</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مقدار انجام شده</label>
                            <input type="number" id="actionValue" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="مقدار">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">توضیحات</label>
                            <textarea id="actionDescription" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="توضیحات اقدام"></textarea>
                        </div>
                        <button onclick="submitAction()" class="btn-primary w-full py-3 rounded-xl text-white font-semibold hover-glow">
                            <i class="fas fa-save ml-2"></i>
                            ثبت اقدام
                        </button>
                    </div>
                </div>
            </div>

            <!-- Employee Marketing Activities -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="glass rounded-2xl p-6 shadow-elegant">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">مشتریان تخصیص داده شده</h3>
                    <div id="assignedCustomers" class="space-y-4 max-h-64 overflow-y-auto">
                        <!-- Assigned customers will be displayed here -->
                    </div>
                </div>

                <div class="glass rounded-2xl p-6 shadow-elegant">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">ثبت فعالیت بازاریابی</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب مشتری</label>
                                <select id="activityCustomer" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                    <option value="">انتخاب کنید</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">نوع فعالیت</label>
                                <select id="activityType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                    <option value="">انتخاب کنید</option>
                                    <option value="پیگیری تلفنی">پیگیری تلفنی</option>
                                    <option value="مذاکره حضوری">مذاکره حضوری</option>
                                    <option value="ارسال پیشنهاد">ارسال پیشنهاد</option>
                                    <option value="بازدید از مشتری">بازدید از مشتری</option>
                                    <option value="جلسه مذاکره">جلسه مذاکره</option>
                                    <option value="پیگیری مدارک">پیگیری مدارک</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">تاریخ و زمان</label>
                            <input type="datetime-local" id="activityDateTime" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">شرح فعالیت</label>
                            <textarea id="activityDetails" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-20" placeholder="شرح کامل فعالیت انجام شده"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">آخرین تصمیمات</label>
                                <textarea id="activityDecisions" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-16" placeholder="تصمیمات گرفته شده"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">وضعیت</label>
                                <select id="activityStatus" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                    <option value="در حال پیگیری">در حال پیگیری</option>
                                    <option value="منتظر پاسخ مشتری">منتظر پاسخ مشتری</option>
                                    <option value="نیاز به پیگیری">نیاز به پیگیری</option>
                                    <option value="تکمیل شده">تکمیل شده</option>
                                    <option value="لغو شده">لغو شده</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">تعهدات به مشتری</label>
                                <textarea id="activityCommitmentsToCustomer" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-16" placeholder="تعهدات داده شده"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">تعهدات مشتری</label>
                                <textarea id="activityCustomerCommitments" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-16" placeholder="تعهدات مشتری"></textarea>
                            </div>
                        </div>
                        <button onclick="submitMarketingActivity()" class="btn-primary w-full py-3 rounded-xl text-white font-semibold hover-glow">
                            <i class="fas fa-save ml-2"></i>
                            ثبت فعالیت
                        </button>
                    </div>
                </div>
            </div>

            <!-- Employee Activities History -->
            <div class="glass rounded-2xl p-6 shadow-elegant mb-8">
                <h3 class="text-xl font-bold text-gray-800 mb-6">تاریخچه فعالیت‌های من</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="gradient-primary text-white">
                            <tr>
                                <th class="px-4 py-3 text-right text-sm font-bold">مشتری</th>
                                <th class="px-4 py-3 text-right text-sm font-bold">نوع فعالیت</th>
                                <th class="px-4 py-3 text-right text-sm font-bold">تاریخ</th>
                                <th class="px-4 py-3 text-right text-sm font-bold">وضعیت</th>
                                <th class="px-4 py-3 text-right text-sm font-bold">جزئیات</th>
                            </tr>
                        </thead>
                        <tbody id="employeeActivitiesTable" class="divide-y divide-gray-200">
                            <!-- Employee activities will be displayed here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Employee Performance -->
            <div class="glass rounded-2xl p-6 shadow-elegant">
                <h3 class="text-xl font-bold text-gray-800 mb-6">عملکرد من</h3>
                <canvas id="employeePerformanceChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="addCustomerModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-6xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <h3 class="text-2xl font-bold text-gray-800">افزودن مشتری هدف جدید</h3>
                    <button onclick="hideAddCustomerModal()" class="w-10 h-10 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="addCustomerForm" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Basic Information -->
                    <div class="space-y-6">
                        <div class="bg-blue-50 rounded-xl p-4">
                            <h4 class="font-bold text-blue-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle ml-2"></i>
                                اطلاعات پایه
                            </h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">نوع مشتری</label>
                            <select id="customerType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                                <option value="">انتخاب کنید</option>
                                <option value="حقیقی">حقیقی</option>
                                <option value="حقوقی">حقوقی</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">نام مشتری</label>
                            <input type="text" id="customerName" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">حوزه فعالیت</label>
                            <input type="text" id="customerField" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="مثال: تولید، خدمات، تجارت">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سابقه فعالیت (سال)</label>
                            <input type="number" id="customerExperience" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">آدرس</label>
                            <textarea id="customerAddress" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">معرف</label>
                            <input type="text" id="customerReferrer" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                    </div>

                    <!-- Financial Information -->
                    <div class="space-y-6">
                        <div class="bg-green-50 rounded-xl p-4">
                            <h4 class="font-bold text-green-800 mb-4 flex items-center">
                                <i class="fas fa-dollar-sign ml-2"></i>
                                اطلاعات مالی و توانمندی‌ها
                            </h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-3">نوع فعالیت مالی</label>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer">
                                    <input type="checkbox" id="activityCurrency" class="ml-3 w-4 h-4 text-blue-600">
                                    <span class="font-medium">ارزی</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer">
                                    <input type="checkbox" id="activityRial" class="ml-3 w-4 h-4 text-blue-600">
                                    <span class="font-medium">ریالی</span>
                                </label>
                                <label class="flex items-center p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer">
                                    <input type="checkbox" id="activityCommitment" class="ml-3 w-4 h-4 text-blue-600">
                                    <span class="font-medium">تعهداتی</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ضمانت‌نامه</label>
                            <select id="customerGuarantee" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="">انتخاب کنید</option>
                                <option value="دارد">دارد</option>
                                <option value="ندارد">ندارد</option>
                                <option value="در حال بررسی">در حال بررسی</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">منابع مالی</label>
                            <textarea id="customerResources" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="توضیح منابع مالی و توانمندی‌های مشتری"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">اولویت</label>
                            <select id="customerPriority" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="متوسط">متوسط</option>
                                <option value="بالا">بالا</option>
                                <option value="بسیار بالا">بسیار بالا</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">توضیحات اضافی</label>
                            <textarea id="customerNotes" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24"></textarea>
                        </div>
                    </div>

                    <div class="lg:col-span-2 flex space-x-4 space-x-reverse pt-6 border-t">
                        <button type="submit" class="btn-primary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-save ml-2"></i>
                            ذخیره مشتری
                        </button>
                        <button type="button" onclick="hideAddCustomerModal()" class="gradient-secondary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Marketing Progress Modal -->
    <div id="marketingProgressModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-4xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <h3 class="text-2xl font-bold text-gray-800">پیشرفت بازاریابی مشتری</h3>
                    <button onclick="hideMarketingProgressModal()" class="w-10 h-10 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="progressCustomerInfo" class="mb-8">
                    <!-- Customer info will be displayed here -->
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="bg-blue-50 rounded-xl p-4">
                            <h4 class="font-bold text-blue-800 mb-4">مراحل بازاریابی</h4>
                            <div id="marketingStages" class="space-y-3">
                                <!-- Marketing stages will be displayed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-green-50 rounded-xl p-4">
                            <h4 class="font-bold text-green-800 mb-4">بروزرسانی پیشرفت</h4>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">انتخاب مرحله</label>
                                    <select id="updateStageSelect" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                        <option value="firstMeeting">اولین ملاقات حضوری</option>
                                        <option value="accountOpening">افتتاح انواع حساب</option>
                                        <option value="resourceTransfer">انتقال منابع</option>
                                        <option value="facilities">تسهیلات</option>
                                        <option value="currencyActivities">فعالیت‌های ارزی</option>
                                        <option value="businessExpansion">توسعه فعالیت‌ها</option>
                                        <option value="modernServices">خدمات مدرن</option>
                                        <option value="welfareAgreement">تفاهم‌نامه رفاهی</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">درصد پیشرفت</label>
                                    <input type="range" id="progressSlider" min="0" max="100" value="0" class="w-full" oninput="updateProgressValue()">
                                    <div class="flex justify-between text-sm text-gray-600 mt-1">
                                        <span>0%</span>
                                        <span id="progressValue">0%</span>
                                        <span>100%</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">تاریخ</label>
                                    <input type="date" id="progressDate" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">یادداشت</label>
                                    <textarea id="progressNotes" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-20" placeholder="توضیحات پیشرفت"></textarea>
                                </div>
                                <button onclick="updateMarketingStage()" class="btn-primary w-full py-3 rounded-xl text-white font-semibold hover-glow">
                                    <i class="fas fa-save ml-2"></i>
                                    بروزرسانی پیشرفت
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Employee to Department Modal -->
    <div id="addEmployeeToDepartmentModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl w-full max-w-2xl max-h-screen overflow-y-auto m-4 shadow-2xl">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-primary w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-user-plus text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800" id="addToDepartmentModalTitle">افزودن کارمند به بخش</h3>
                            <p class="text-gray-600 text-sm">انتخاب کارمندان برای تخصیص به بخش</p>
                        </div>
                    </div>
                    <button onclick="hideAddEmployeeToDepartmentModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Available Employees List -->
                <div class="mb-6">
                    <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-users ml-2 text-blue-500"></i>
                        کارمندان موجود
                    </h4>
                    <div class="bg-gray-50 rounded-2xl p-4 max-h-80 overflow-y-auto">
                        <div id="availableEmployeesList" class="space-y-3">
                            <!-- Available employees will be listed here -->
                        </div>
                    </div>
                </div>
                
                <!-- Selected Employees -->
                <div class="mb-8">
                    <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-check-circle ml-2 text-green-500"></i>
                        کارمندان انتخاب شده
                    </h4>
                    <div class="bg-green-50 rounded-2xl p-4 min-h-20">
                        <div id="selectedEmployeesList" class="space-y-2">
                            <p class="text-gray-500 text-sm text-center">هیچ کارمندی انتخاب نشده است</p>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-4 space-x-reverse">
                    <button onclick="confirmAddEmployeesToDepartment()" class="btn-primary flex-1 py-4 rounded-2xl text-white font-bold text-lg hover-glow">
                        <i class="fas fa-check ml-2"></i>
                        تأیید و افزودن
                    </button>
                    <button onclick="hideAddEmployeeToDepartmentModal()" class="bg-gray-500 hover:bg-gray-600 flex-1 py-4 rounded-2xl text-white font-bold text-lg">
                        <i class="fas fa-times ml-2"></i>
                        انصراف
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Employee Modal -->
    <div id="addEmployeeModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-4xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-primary w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-user-plus text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800" id="modalTitle">افزودن کارمند جدید</h3>
                            <p class="text-gray-600 text-sm">اطلاعات کامل کارمند را وارد کنید</p>
                        </div>
                    </div>
                    <button onclick="hideAddEmployeeModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="addEmployeeForm" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Personal Information -->
                    <div class="space-y-6">
                        <div class="bg-blue-50 rounded-xl p-4">
                            <h4 class="font-bold text-blue-800 mb-4 flex items-center">
                                <i class="fas fa-user ml-2"></i>
                                اطلاعات شخصی
                            </h4>
                        </div>
                        
                        <div class="relative">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">نام و نام خانوادگی *</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i class="fas fa-user text-gray-400"></i>
                                </div>
                                <input type="text" id="newEmployeeName" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="نام کامل کارمند" required>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="relative">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">کد پرسنلی *</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i class="fas fa-id-badge text-gray-400"></i>
                                    </div>
                                    <input type="text" id="newEmployeeCode" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="کد یکتا" required>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">کد ملی *</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i class="fas fa-id-card text-gray-400"></i>
                                    </div>
                                    <input type="text" id="newEmployeeNationalId" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="کد ملی 10 رقمی" maxlength="10" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">شماره تماس</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i class="fas fa-phone text-gray-400"></i>
                                    </div>
                                    <input type="tel" id="newEmployeePhone" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="09xxxxxxxxx">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ایمیل</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                        <i class="fas fa-envelope text-gray-400"></i>
                                    </div>
                                    <input type="email" id="newEmployeeEmail" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="example@email.com">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">آدرس</label>
                            <textarea id="newEmployeeAddress" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-24" placeholder="آدرس کامل محل سکونت"></textarea>
                        </div>
                    </div>

                    <!-- Work Information -->
                    <div class="space-y-6">
                        <div class="bg-green-50 rounded-xl p-4">
                            <h4 class="font-bold text-green-800 mb-4 flex items-center">
                                <i class="fas fa-briefcase ml-2"></i>
                                اطلاعات شغلی
                            </h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">تاریخ ورود *</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i class="fas fa-calendar text-gray-400"></i>
                                </div>
                                <input type="date" id="newEmployeeDate" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سمت *</label>
                            <select id="newEmployeePosition" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                <option value="">انتخاب کنید</option>
                                <option value="مدیر شعبه">مدیر شعبه</option>
                                <option value="معاون مدیر">معاون مدیر</option>
                                <option value="مسئول بخش">مسئول بخش</option>
                                <option value="کارشناس ارشد">کارشناس ارشد</option>
                                <option value="کارشناس">کارشناس</option>
                                <option value="کارشناس بازاریابی">کارشناس بازاریابی</option>
                                <option value="کارشناس وصول">کارشناس وصول</option>
                                <option value="کارشناس POS">کارشناس POS</option>
                                <option value="کارشناس خدمات مدرن">کارشناس خدمات مدرن</option>
                                <option value="کارشناس ارزیابی">کارشناس ارزیابی</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">سطح دسترسی</label>
                            <select id="newEmployeeAccessLevel" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="employee">کارمند عادی</option>
                                <option value="supervisor">سرپرست</option>
                                <option value="manager">مدیر بخش</option>
                                <option value="admin">مدیر کل</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">حقوق پایه (تومان)</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i class="fas fa-money-bill text-gray-400"></i>
                                </div>
                                <input type="number" id="newEmployeeSalary" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="0">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">وضعیت</label>
                            <select id="newEmployeeStatus" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="active">فعال</option>
                                <option value="inactive">غیرفعال</option>
                                <option value="suspended">تعلیق</option>
                                <option value="terminated">اخراج</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">توضیحات</label>
                            <textarea id="newEmployeeNotes" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-24" placeholder="توضیحات اضافی در مورد کارمند"></textarea>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="lg:col-span-2 flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="btn-primary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-save ml-2"></i>
                            <span id="submitButtonText">ذخیره کارمند</span>
                        </button>
                        <button type="button" onclick="hideAddEmployeeModal()" class="gradient-secondary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ticker Edit Modal -->
    <div id="tickerEditModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-2xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-primary w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-chart-line text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800" id="tickerModalTitle">ویرایش شاخص مالی</h3>
                            <p class="text-gray-600 text-sm">بروزرسانی اطلاعات شاخص‌های مالی</p>
                        </div>
                    </div>
                    <button onclick="hideTickerEditModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="tickerEditForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Current Value -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">مقدار فعلی (ریال)</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i class="fas fa-money-bill text-gray-400"></i>
                                </div>
                                <input type="number" id="tickerCurrentValue" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="0" required>
                            </div>
                        </div>
                        
                        <!-- Change Percentage -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">درصد تغییر</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <i class="fas fa-percentage text-gray-400"></i>
                                </div>
                                <input type="number" step="0.1" id="tickerChangePercent" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="0.0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Target Value (for applicable metrics) -->
                    <div id="tickerTargetSection" class="hidden">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">مقدار هدف (ریال)</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <i class="fas fa-bullseye text-gray-400"></i>
                            </div>
                            <input type="number" id="tickerTargetValue" class="form-input w-full pr-10 pl-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="0">
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">توضیحات</label>
                        <textarea id="tickerDescription" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-24" placeholder="توضیحات اضافی در مورد این شاخص"></textarea>
                    </div>
                    
                    <!-- Update Frequency -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">فرکانس بروزرسانی</label>
                        <select id="tickerUpdateFrequency" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="realtime">لحظه‌ای</option>
                            <option value="hourly">ساعتی</option>
                            <option value="daily">روزانه</option>
                            <option value="weekly">هفتگی</option>
                            <option value="monthly">ماهانه</option>
                        </select>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="btn-primary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-save ml-2"></i>
                            بروزرسانی شاخص
                        </button>
                        <button type="button" onclick="hideTickerEditModal()" class="gradient-secondary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Score Modal -->
    <div id="scoreModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-4xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-primary w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-star text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">نمره‌دهی کارمند</h3>
                            <p class="text-gray-600 text-sm">ارزیابی عملکرد <span id="scoreModalEmployeeName" class="font-semibold"></span></p>
                        </div>
                    </div>
                    <button onclick="hideScoreModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="scoreForm" class="space-y-8">
                    <!-- Quantitative Scores -->
                    <div class="bg-blue-50 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-blue-800 mb-6 flex items-center">
                            <i class="fas fa-chart-bar ml-2"></i>
                            نمرات کمی (از 100)
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Quality Score -->
                            <div class="space-y-3">
                                <label class="block text-sm font-bold text-gray-700">کیفیت کار</label>
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <input type="range" id="qualityScore" min="0" max="100" value="75" class="flex-1" oninput="updateScoreValue('quality')">
                                    <span class="text-2xl font-bold text-blue-600 w-12 text-center" id="qualityValue">75</span>
                                </div>
                            </div>
                            
                            <!-- Speed Score -->
                            <div class="space-y-3">
                                <label class="block text-sm font-bold text-gray-700">سرعت انجام کار</label>
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <input type="range" id="speedScore" min="0" max="100" value="75" class="flex-1" oninput="updateScoreValue('speed')">
                                    <span class="text-2xl font-bold text-green-600 w-12 text-center" id="speedValue">75</span>
                                </div>
                            </div>
                            
                            <!-- Attendance Score -->
                            <div class="space-y-3">
                                <label class="block text-sm font-bold text-gray-700">حضور و غیاب</label>
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <input type="range" id="attendanceScore" min="0" max="100" value="75" class="flex-1" oninput="updateScoreValue('attendance')">
                                    <span class="text-2xl font-bold text-orange-600 w-12 text-center" id="attendanceValue">75</span>
                                </div>
                            </div>
                            
                            <!-- Teamwork Score -->
                            <div class="space-y-3">
                                <label class="block text-sm font-bold text-gray-700">همکاری تیمی</label>
                                <div class="flex items-center space-x-4 space-x-reverse">
                                    <input type="range" id="teamworkScore" min="0" max="100" value="75" class="flex-1" oninput="updateScoreValue('teamwork')">
                                    <span class="text-2xl font-bold text-purple-600 w-12 text-center" id="teamworkValue">75</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Average Score -->
                        <div class="mt-6 text-center">
                            <div class="bg-white rounded-xl p-4 inline-block">
                                <p class="text-sm text-gray-600 mb-2">میانگین نمرات</p>
                                <p class="text-4xl font-bold text-indigo-600" id="averageScore">75</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Qualitative Assessment -->
                    <div class="bg-green-50 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-green-800 mb-6 flex items-center">
                            <i class="fas fa-comments ml-2"></i>
                            ارزیابی کیفی
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">نقاط قوت</label>
                                <textarea id="strengths" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="نقاط قوت کارمند را بنویسید..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">نقاط ضعف</label>
                                <textarea id="weaknesses" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="نقاط ضعف و موارد نیاز به بهبود..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">پیشنهادات بهبود</label>
                                <textarea id="improvements" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="پیشنهادات برای بهبود عملکرد..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Evaluation Period -->
                    <div class="bg-purple-50 rounded-2xl p-6">
                        <h4 class="text-xl font-bold text-purple-800 mb-6 flex items-center">
                            <i class="fas fa-calendar ml-2"></i>
                            دوره ارزیابی
                        </h4>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">نوع دوره</label>
                                <select id="evaluationPeriod" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                    <option value="monthly">ماهانه</option>
                                    <option value="quarterly">فصلی</option>
                                    <option value="yearly">سالانه</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">تاریخ شروع</label>
                                <input type="date" id="evaluationStartDate" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">تاریخ پایان</label>
                                <input type="date" id="evaluationEndDate" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="btn-primary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-save ml-2"></i>
                            ثبت ارزیابی
                        </button>
                        <button type="button" onclick="hideScoreModal()" class="gradient-secondary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Warning Modal -->
    <div id="warningModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-3xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-secondary w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">ارسال تذکر</h3>
                            <p class="text-gray-600 text-sm">تذکر برای <span id="warningModalEmployeeName" class="font-semibold"></span></p>
                        </div>
                    </div>
                    <button onclick="hideWarningModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="warningForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Warning Type -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">نوع تذکر</label>
                            <select id="warningType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                                <option value="">انتخاب کنید</option>
                                <option value="شفاهی">شفاهی</option>
                                <option value="کتبی">کتبی</option>
                                <option value="نهایی">نهایی</option>
                            </select>
                        </div>
                        
                        <!-- Warning Subject -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">موضوع تذکر</label>
                            <select id="warningSubject" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                                <option value="">انتخاب کنید</option>
                                <option value="حضور و غیاب">حضور و غیاب</option>
                                <option value="عملکرد ضعیف">عملکرد ضعیف</option>
                                <option value="رفتار نامناسب">رفتار نامناسب</option>
                                <option value="نقض انضباط">نقض انضباط</option>
                                <option value="سایر">سایر</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">شرح تذکر</label>
                        <textarea id="warningDescription" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-32" placeholder="شرح کامل موضوع تذکر..." required></textarea>
                    </div>
                    
                    <!-- Expected Actions -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">اقدامات مورد انتظار</label>
                        <textarea id="expectedActions" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="اقداماتی که از کارمند انتظار می‌رود..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Correction Deadline -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">مهلت اصلاح (روز)</label>
                            <input type="number" id="correctionDeadline" min="1" max="90" value="7" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                        </div>
                        
                        <!-- Priority -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">سطح اولویت</label>
                            <select id="warningPriority" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="low">کم</option>
                                <option value="medium" selected>متوسط</option>
                                <option value="high">بالا</option>
                                <option value="critical">بحرانی</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="gradient-secondary flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-paper-plane ml-2"></i>
                            ارسال تذکر
                        </button>
                        <button type="button" onclick="hideWarningModal()" class="bg-gray-500 hover:bg-gray-600 flex-1 py-4 rounded-xl text-white font-bold text-lg">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Message Modal -->
    <div id="messageModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-3xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-success w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-envelope text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">ارسال پیام کاری</h3>
                            <p class="text-gray-600 text-sm">پیام برای <span id="messageModalEmployeeName" class="font-semibold"></span></p>
                        </div>
                    </div>
                    <button onclick="hideMessageModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="messageForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Message Type -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">نوع پیام</label>
                            <select id="messageType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                                <option value="">انتخاب کنید</option>
                                <option value="اطلاعاتی">اطلاعاتی</option>
                                <option value="دستورالعمل">دستورالعمل</option>
                                <option value="یادآوری">یادآوری</option>
                                <option value="تبریک">تبریک</option>
                                <option value="جلسه">دعوت به جلسه</option>
                            </select>
                        </div>
                        
                        <!-- Priority -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">اولویت</label>
                            <select id="messagePriority" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="normal">عادی</option>
                                <option value="high">بالا</option>
                                <option value="urgent">فوری</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Subject -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">موضوع پیام</label>
                        <input type="text" id="messageSubject" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="موضوع پیام..." required>
                    </div>
                    
                    <!-- Content -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">متن پیام</label>
                        <textarea id="messageContent" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-32" placeholder="متن کامل پیام..." required></textarea>
                    </div>
                    
                    <!-- Requires Response -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">نیاز به پاسخ</label>
                        <select id="requiresResponse" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                            <option value="no">خیر</option>
                            <option value="yes">بله</option>
                        </select>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="gradient-success flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-paper-plane ml-2"></i>
                            ارسال پیام
                        </button>
                        <button type="button" onclick="hideMessageModal()" class="bg-gray-500 hover:bg-gray-600 flex-1 py-4 rounded-xl text-white font-bold text-lg">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-4xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-info w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-tasks text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">تعریف وظیفه</h3>
                            <p class="text-gray-600 text-sm">وظیفه برای <span id="taskModalEmployeeName" class="font-semibold"></span></p>
                        </div>
                    </div>
                    <button onclick="hideTaskModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="taskForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Task Title -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">عنوان وظیفه</label>
                            <input type="text" id="taskTitle" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="عنوان وظیفه..." required>
                        </div>
                        
                        <!-- Task Type -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">نوع وظیفه</label>
                            <select id="taskType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                                <option value="">انتخاب کنید</option>
                                <option value="روزانه">روزانه</option>
                                <option value="هفتگی">هفتگی</option>
                                <option value="ماهانه">ماهانه</option>
                                <option value="پروژه‌ای">پروژه‌ای</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">شرح وظیفه</label>
                        <textarea id="taskDescription" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-32" placeholder="شرح کامل وظیفه و نحوه انجام..." required></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Start Date -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">تاریخ شروع</label>
                            <input type="date" id="taskStartDate" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                        </div>
                        
                        <!-- Deadline -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">مهلت انجام</label>
                            <input type="date" id="taskDeadline" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                        </div>
                        
                        <!-- Priority -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">اولویت</label>
                            <select id="taskPriority" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="low">کم</option>
                                <option value="medium" selected>متوسط</option>
                                <option value="high">بالا</option>
                                <option value="critical">بحرانی</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Delivery Criteria -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">معیارهای تحویل</label>
                        <textarea id="taskCriteria" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-24" placeholder="شرایط و معیارهای تکمیل وظیفه..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Estimated Hours -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">تخمین ساعت انجام</label>
                            <input type="number" id="estimatedHours" min="1" max="200" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="ساعت">
                        </div>
                        
                        <!-- Progress Reporting -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">گزارش پیشرفت</label>
                            <select id="requiresProgress" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="none">بدون نیاز</option>
                                <option value="daily">روزانه</option>
                                <option value="weekly">هفتگی</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="gradient-info flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-plus ml-2"></i>
                            تعریف وظیفه
                        </button>
                        <button type="button" onclick="hideTaskModal()" class="bg-gray-500 hover:bg-gray-600 flex-1 py-4 rounded-xl text-white font-bold text-lg">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-3xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-warning w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-comment-dots text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">درخواست بازخورد</h3>
                            <p class="text-gray-600 text-sm">بازخورد از <span id="feedbackModalEmployeeName" class="font-semibold"></span></p>
                        </div>
                    </div>
                    <button onclick="hideFeedbackModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="feedbackForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Feedback Type -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">نوع بازخورد</label>
                            <select id="feedbackType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" required>
                                <option value="">انتخاب کنید</option>
                                <option value="عملکرد">عملکرد کلی</option>
                                <option value="پروژه خاص">پروژه خاص</option>
                                <option value="عمومی">بازخورد عمومی</option>
                                <option value="پیشنهاد بهبود">پیشنهاد بهبود</option>
                            </select>
                        </div>
                        
                        <!-- Response Type -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">نوع پاسخ</label>
                            <select id="responseType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                                <option value="written">کتبی</option>
                                <option value="meeting">جلسه حضوری</option>
                                <option value="both">هر دو</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Subject -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">موضوع بازخورد</label>
                        <input type="text" id="feedbackSubject" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl" placeholder="موضوع بازخورد..." required>
                    </div>
                    
                    <!-- Questions -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">سوالات مشخص</label>
                        <textarea id="feedbackQuestions" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl h-32" placeholder="سوالات دقیق که از کارمند می‌پرسید..." required></textarea>
                    </div>
                    
                    <!-- Deadline -->
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">مهلت پاسخ (روز)</label>
                        <input type="number" id="feedbackDeadline" min="1" max="30" value="7" class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl">
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex space-x-4 space-x-reverse pt-6 border-t border-gray-200">
                        <button type="submit" class="gradient-warning flex-1 py-4 rounded-xl text-white font-bold text-lg hover-glow">
                            <i class="fas fa-paper-plane ml-2"></i>
                            ارسال درخواست
                        </button>
                        <button type="button" onclick="hideFeedbackModal()" class="bg-gray-500 hover:bg-gray-600 flex-1 py-4 rounded-xl text-white font-bold text-lg">
                            <i class="fas fa-times ml-2"></i>
                            انصراف
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Employee Details Modal -->
    <div id="employeeDetailsModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="glass rounded-3xl w-full max-w-4xl max-h-screen overflow-y-auto m-4 shadow-luxury">
            <div class="p-8">
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="gradient-info w-12 h-12 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">جزئیات کارمند</h3>
                            <p class="text-gray-600 text-sm">اطلاعات کامل و عملکرد</p>
                        </div>
                    </div>
                    <button onclick="hideEmployeeDetailsModal()" class="w-12 h-12 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition-all hover:scale-110">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="employeeDetailsContent">
                    <!-- Employee details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let employees = [];
        let departments = {
            marketing: { manager: '', employees: [], goals: { monthly: 0, yearly: 0 }, metrics: [] },
            collection: { manager: '', employees: [], goals: { monthly: 0, yearly: 0 }, metrics: [] },
            pos: { manager: '', employees: [], goals: { monthly: 0, yearly: 0 }, metrics: [] },
            modern: { manager: '', employees: [], goals: { monthly: 0, yearly: 0 }, metrics: [] },
            evaluation: { manager: '', employees: [], goals: { monthly: 0, yearly: 0 }, metrics: [] }
        };
        let currentUser = null;
        let employeeActions = [];
        let realtimeActivities = [];
        let topPerformersData = [];
        let customers = [];
        let customerAssignments = [];
        let marketingActivities = [];
        
        // Employee Evaluation Data
        let selectedEmployeeForEvaluation = null;
        let employeeEvaluations = [];
        let employeeWarnings = [];
        let employeeMessages = [];
        let employeeTasks = [];
        let employeeFeedbacks = [];
        
        // Financial Ticker Data
        let tickerData = {
            dailyResources: { value: 2450000000, change: 12.5, target: null },
            resourceTarget: { value: 3000000000, change: 0, target: 3000000000 },
            profitLoss: { value: 185000000, change: 8.2, target: null },
            expenses: { value: 1265000000, change: -3.1, target: null },
            claims: { value: 890000000, change: -1.5, target: null },
            deposits: { value: 4120000000, change: 15.8, target: null },
            facilities: { value: 1850000000, change: 6.7, target: null }
        };
        
        let currentTickerMetric = null;
        let tickerCollapsed = false;

        // Initialize - Fixed
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Page loaded, initializing...');
            
            try {
                // Load sample data first
                loadSampleData();
                console.log('✅ Sample data loaded');
                
                // Setup login form
                setTimeout(() => {
                    setupLoginForm();
                    console.log('✅ Login form setup complete');
                }, 100);
                
                // Initialize charts
                setTimeout(() => {
                    initializeCharts();
                    console.log('✅ Charts initialized');
                }, 200);
                
                // Update time
                updateLastUpdateTime();
                setInterval(updateLastUpdateTime, 60000);
                
                // Test elements after DOM is ready
                setTimeout(() => {
                    console.log('🧪 Testing elements...');
                    console.log('Login form:', document.getElementById('loginForm'));
                    console.log('Username input:', document.getElementById('username'));
                    console.log('Password input:', document.getElementById('password'));
                    console.log('Admin dashboard:', document.getElementById('adminDashboard'));
                    console.log('Employee dashboard:', document.getElementById('employeeDashboard'));
                }, 500);
                
                console.log('✅ All initialization complete');
                
            } catch (error) {
                console.error('❌ Initialization error:', error);
            }
        });

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fa-IR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const element = document.getElementById('lastUpdate');
            const sidebarElement = document.getElementById('lastUpdateSidebar');
            
            if (element) {
                element.textContent = timeString;
            }
            if (sidebarElement) {
                sidebarElement.textContent = timeString;
            }
        }

        // Login System - Completely Fixed
        function setupLoginForm() {
            console.log('🔧 Setting up login form...');
            const loginForm = document.getElementById('loginForm');
            
            if (loginForm) {
                console.log('✅ Login form found, adding event listener');
                
                // Remove any existing event listeners
                const newForm = loginForm.cloneNode(true);
                loginForm.parentNode.replaceChild(newForm, loginForm);
                
                newForm.addEventListener('submit', function(event) {
                    event.preventDefault();
                    console.log('📝 Form submitted');
                    
                    const usernameInput = document.getElementById('username');
                    const passwordInput = document.getElementById('password');
                    
                    if (!usernameInput || !passwordInput) {
                        console.log('❌ Input fields not found');
                        return;
                    }
                    
                    const username = usernameInput.value.trim();
                    const password = passwordInput.value.trim();
                    
                    console.log(`🔍 Login attempt - Username: "${username}", Password: "${password}"`);
                    
                    // Validate inputs
                    if (!username || !password) {
                        console.log('❌ Empty credentials');
                        showLoginError('لطفاً نام کاربری و رمز عبور را وارد کنید');
                        return;
                    }
                    
                    // Check admin login with exact match
                    console.log(`🧪 Checking admin: "${username}" === "admin": ${username === 'admin'}`);
                    console.log(`🧪 Checking admin: "${password}" === "admin": ${password === 'admin'}`);
                    
                    if (username === 'admin' && password === 'admin') {
                        console.log('✅ Admin login successful');
                        loginSuccess('admin', null);
                        return;
                    }
                    
                    // Check employee login
                    const employee = findEmployee(username, password);
                    if (employee) {
                        console.log('✅ Employee login successful:', employee.name);
                        loginSuccess('employee', employee);
                        return;
                    }
                    
                    // Login failed
                    console.log('❌ Login failed');
                    showLoginError('نام کاربری یا رمز عبور اشتباه است');
                });
                
                console.log('✅ Event listener attached successfully');
            } else {
                console.log('❌ Login form not found!');
            }
        }

        function findEmployee(username, password) {
            return employees.find(emp => emp.code === username && emp.nationalId === password);
        }

        function loginSuccess(userType, employeeData) {
            console.log(`🎉 Login success for ${userType}`);
            
            try {
                if (userType === 'admin') {
                    currentUser = { type: 'admin', username: 'admin' };
                    
                    // Hide login screen
                    const loginScreen = document.getElementById('loginScreen');
                    if (loginScreen) {
                        loginScreen.style.display = 'none';
                        console.log('✅ Login screen hidden');
                    }
                    
                    // Show admin dashboard
                    const adminDashboard = document.getElementById('adminDashboard');
                    if (adminDashboard) {
                        adminDashboard.style.display = 'block';
                        console.log('✅ Admin dashboard shown');
                    }
                    
                    showNotification('خوش آمدید مدیر سیستم!', 'success');
                    
                    // Show ticker and initialize admin dashboard
                    setTimeout(() => {
                        showTicker();
                        updateDashboardMetrics();
                        updateEmployeeSelects();
                        initializeTicker();
                        console.log('✅ Admin dashboard initialized');
                    }, 100);
                    
                } else if (userType === 'employee') {
                    currentUser = { type: 'employee', data: employeeData };
                    
                    // Hide login screen
                    const loginScreen = document.getElementById('loginScreen');
                    if (loginScreen) {
                        loginScreen.style.display = 'none';
                    }
                    
                    // Show employee dashboard
                    const employeeDashboard = document.getElementById('employeeDashboard');
                    if (employeeDashboard) {
                        employeeDashboard.style.display = 'block';
                    }
                    
                    // Update employee info
                    const employeeName = document.getElementById('employeeName');
                    const employeeDepartment = document.getElementById('employeeDepartment');
                    
                    if (employeeName) employeeName.textContent = employeeData.name;
                    if (employeeDepartment) employeeDepartment.textContent = getEmployeeDepartment(employeeData.code);
                    
                    showNotification(`خوش آمدید ${employeeData.name}!`, 'success');
                    
                    // Initialize employee dashboard
                    setTimeout(() => {
                        loadEmployeeGoals(employeeData);
                        loadEmployeeMetrics(employeeData);
                        updateEmployeeCustomers();
                        updateEmployeeActivitiesTable();
                    }, 100);
                }
            } catch (error) {
                console.error('❌ Error in loginSuccess:', error);
                showNotification('خطا در ورود به سیستم', 'error');
            }
        }

        function showLoginError(message) {
            showNotification(message, 'error');
        }

        function clearLoginErrors() {
            // Clear any existing error messages
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 left-4 z-50 p-4 rounded-xl shadow-luxury max-w-sm ${
                type === 'error' ? 'bg-red-50 text-red-800 border-red-200' : 
                type === 'success' ? 'bg-green-50 text-green-800 border-green-200' : 
                'bg-blue-50 text-blue-800 border-blue-200'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${
                        type === 'error' ? 'fa-exclamation-circle' : 
                        type === 'success' ? 'fa-check-circle' : 
                        'fa-info-circle'
                    } ml-2"></i>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }



        function logout() {
            currentUser = null;
            const loginScreen = document.getElementById('loginScreen');
            const adminDashboard = document.getElementById('adminDashboard');
            const employeeDashboard = document.getElementById('employeeDashboard');
            const ticker = document.getElementById('financialTicker');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            if (loginScreen) loginScreen.style.display = 'flex';
            if (adminDashboard) adminDashboard.style.display = 'none';
            if (employeeDashboard) employeeDashboard.style.display = 'none';
            if (ticker) ticker.style.display = 'none';
            if (usernameInput) usernameInput.value = '';
            if (passwordInput) passwordInput.value = '';
            
            showNotification('با موفقیت خارج شدید', 'info');
        }

        // Backup login method for testing
        function testLogin() {
            console.log('🧪 Testing login manually...');
            const username = 'admin';
            const password = 'admin';
            
            if (username === 'admin' && password === 'admin') {
                console.log('✅ Manual test login successful');
                loginSuccess('admin', null);
            } else {
                console.log('❌ Manual test login failed');
            }
        }

        // Add global test function
        window.testAdminLogin = function() {
            console.log('🔧 Global test login called');
            testLogin();
        };

        // Section Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            if (sectionName === 'reports') {
                updateReportsSection();
            } else if (sectionName === 'marketing') {
                updateMarketingEmployeeSelect();
                updateCustomersList();
                updateAssignmentsTable();
                updateActivitiesTable();
                updateProgressCustomerSelect();
            } else if (sectionName === 'evaluation') {
                initializeEvaluationSection();
            }
        }

        // Employee Management - Enhanced
        let currentEditingEmployee = null;
        let currentPage = 1;
        let recordsPerPage = 10;
        let filteredEmployees = [];
        let sortColumn = '';
        let sortDirection = 'asc';

        function showAddEmployeeModal() {
            currentEditingEmployee = null;
            document.getElementById('modalTitle').textContent = 'افزودن کارمند جدید';
            document.getElementById('submitButtonText').textContent = 'ذخیره کارمند';
            document.getElementById('addEmployeeForm').reset();
            document.getElementById('addEmployeeModal').style.display = 'flex';
        }

        function showEditEmployeeModal(index) {
            currentEditingEmployee = index;
            const employee = employees[index];
            
            document.getElementById('modalTitle').textContent = 'ویرایش کارمند';
            document.getElementById('submitButtonText').textContent = 'بروزرسانی اطلاعات';
            
            // Fill form with employee data
            document.getElementById('newEmployeeName').value = employee.name || '';
            document.getElementById('newEmployeeCode').value = employee.code || '';
            document.getElementById('newEmployeeNationalId').value = employee.nationalId || '';
            document.getElementById('newEmployeeDate').value = employee.joinDate || '';
            document.getElementById('newEmployeePosition').value = employee.position || '';
            document.getElementById('newEmployeePhone').value = employee.phone || '';
            document.getElementById('newEmployeeEmail').value = employee.email || '';
            document.getElementById('newEmployeeAddress').value = employee.address || '';
            document.getElementById('newEmployeeAccessLevel').value = employee.accessLevel || 'employee';
            document.getElementById('newEmployeeSalary').value = employee.salary || '';
            document.getElementById('newEmployeeStatus').value = employee.status || 'active';
            document.getElementById('newEmployeeNotes').value = employee.notes || '';
            
            document.getElementById('addEmployeeModal').style.display = 'flex';
        }

        function hideAddEmployeeModal() {
            document.getElementById('addEmployeeModal').style.display = 'none';
            document.getElementById('addEmployeeForm').reset();
            currentEditingEmployee = null;
        }

        function showEmployeeDetails(index) {
            const employee = employees[index];
            const modal = document.getElementById('employeeDetailsModal');
            const content = document.getElementById('employeeDetailsContent');
            
            const departmentInfo = getEmployeeDepartmentInfo(employee.code);
            const statusBadge = getStatusBadge(employee.status || 'active');
            
            content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Employee Profile -->
                    <div class="lg:col-span-1">
                        <div class="glass rounded-2xl p-6 text-center">
                            <div class="gradient-primary w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas fa-user text-white text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${employee.name}</h3>
                            <p class="text-gray-600 mb-4">${employee.position}</p>
                            ${statusBadge}
                            
                            <div class="mt-6 space-y-3 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">کد پرسنلی:</span>
                                    <span class="font-medium">${employee.code}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">کد ملی:</span>
                                    <span class="font-medium">${employee.nationalId}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">تاریخ ورود:</span>
                                    <span class="font-medium">${employee.joinDate}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Information -->
                    <div class="lg:col-span-1">
                        <div class="glass rounded-2xl p-6">
                            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-address-book ml-2 text-blue-500"></i>
                                اطلاعات تماس
                            </h4>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <i class="fas fa-phone text-gray-400"></i>
                                    <span class="text-gray-700">${employee.phone || 'ثبت نشده'}</span>
                                </div>
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <i class="fas fa-envelope text-gray-400"></i>
                                    <span class="text-gray-700">${employee.email || 'ثبت نشده'}</span>
                                </div>
                                <div class="flex items-start space-x-3 space-x-reverse">
                                    <i class="fas fa-map-marker-alt text-gray-400 mt-1"></i>
                                    <span class="text-gray-700">${employee.address || 'ثبت نشده'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass rounded-2xl p-6 mt-6">
                            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-building ml-2 text-green-500"></i>
                                اطلاعات سازمانی
                            </h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">سطح دسترسی:</span>
                                    <span class="font-medium">${getAccessLevelText(employee.accessLevel || 'employee')}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">حقوق پایه:</span>
                                    <span class="font-medium">${employee.salary ? employee.salary.toLocaleString() + ' تومان' : 'ثبت نشده'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">بخش‌ها:</span>
                                    <div class="text-left">${departmentInfo}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance & Notes -->
                    <div class="lg:col-span-1">
                        <div class="glass rounded-2xl p-6">
                            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-chart-line ml-2 text-purple-500"></i>
                                عملکرد
                            </h4>
                            <div class="text-center py-8">
                                <div class="gradient-success w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-trophy text-white text-2xl"></i>
                                </div>
                                <p class="text-gray-600">اطلاعات عملکرد در حال بروزرسانی</p>
                            </div>
                        </div>
                        
                        ${employee.notes ? `
                        <div class="glass rounded-2xl p-6 mt-6">
                            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-sticky-note ml-2 text-yellow-500"></i>
                                یادداشت‌ها
                            </h4>
                            <p class="text-gray-700 text-sm leading-relaxed">${employee.notes}</p>
                        </div>
                        ` : ''}
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-4 space-x-reverse mt-8 pt-6 border-t border-gray-200">
                    <button onclick="showEditEmployeeModal(${index}); hideEmployeeDetailsModal();" class="btn-primary px-6 py-3 rounded-xl text-white font-semibold hover-glow">
                        <i class="fas fa-edit ml-2"></i>
                        ویرایش اطلاعات
                    </button>
                    <button onclick="deleteEmployee(${index}); hideEmployeeDetailsModal();" class="gradient-secondary px-6 py-3 rounded-xl text-white font-semibold hover-glow">
                        <i class="fas fa-trash ml-2"></i>
                        حذف کارمند
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function hideEmployeeDetailsModal() {
            document.getElementById('employeeDetailsModal').style.display = 'none';
        }

        function getStatusBadge(status) {
            const statusConfig = {
                'active': { text: 'فعال', class: 'bg-green-100 text-green-800' },
                'inactive': { text: 'غیرفعال', class: 'bg-gray-100 text-gray-800' },
                'suspended': { text: 'تعلیق', class: 'bg-yellow-100 text-yellow-800' },
                'terminated': { text: 'اخراج', class: 'bg-red-100 text-red-800' }
            };
            
            const config = statusConfig[status] || statusConfig['active'];
            return `<span class="px-3 py-1 rounded-full text-sm font-medium ${config.class}">${config.text}</span>`;
        }

        function getAccessLevelText(level) {
            const levels = {
                'employee': 'کارمند عادی',
                'supervisor': 'سرپرست',
                'manager': 'مدیر بخش',
                'admin': 'مدیر کل'
            };
            return levels[level] || 'کارمند عادی';
        }

        function getEmployeeDepartmentInfo(employeeCode) {
            let badges = [];
            for (let dept in departments) {
                if (departments[dept].manager === employeeCode) {
                    badges.push(`<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mb-1">مسئول ${getDepartmentName(dept)}</span>`);
                } else if (departments[dept].employees.includes(employeeCode)) {
                    badges.push(`<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 mb-1">${getDepartmentName(dept)}</span>`);
                }
            }
            return badges.length > 0 ? badges.join('<br>') : '<span class="text-gray-400 text-sm">نامشخص</span>';
        }

        document.getElementById('addEmployeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const employeeData = {
                name: document.getElementById('newEmployeeName').value,
                code: document.getElementById('newEmployeeCode').value,
                nationalId: document.getElementById('newEmployeeNationalId').value,
                joinDate: document.getElementById('newEmployeeDate').value,
                position: document.getElementById('newEmployeePosition').value,
                phone: document.getElementById('newEmployeePhone').value,
                email: document.getElementById('newEmployeeEmail').value,
                address: document.getElementById('newEmployeeAddress').value,
                accessLevel: document.getElementById('newEmployeeAccessLevel').value,
                salary: parseInt(document.getElementById('newEmployeeSalary').value) || 0,
                status: document.getElementById('newEmployeeStatus').value,
                notes: document.getElementById('newEmployeeNotes').value,
                department: ''
            };
            
            // Validate unique code and national ID
            const existingEmployee = employees.find((emp, index) => 
                index !== currentEditingEmployee && 
                (emp.code === employeeData.code || emp.nationalId === employeeData.nationalId)
            );
            
            if (existingEmployee) {
                showNotification('کد پرسنلی یا کد ملی تکراری است', 'error');
                return;
            }
            
            if (currentEditingEmployee !== null) {
                // Update existing employee
                employees[currentEditingEmployee] = { ...employees[currentEditingEmployee], ...employeeData };
                showNotification('اطلاعات کارمند با موفقیت بروزرسانی شد', 'success');
            } else {
                // Add new employee
                employees.push(employeeData);
                showNotification('کارمند جدید با موفقیت اضافه شد', 'success');
            }
            
            updateEmployeesTable();
            updateEmployeeSelects();
            updateEmployeeStats();
            hideAddEmployeeModal();
        });

        function updateEmployeesTable() {
            filteredEmployees = filterEmployeesList();
            const tbody = document.getElementById('employeesTable');
            tbody.innerHTML = '';
            
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = recordsPerPage === 100 ? filteredEmployees.length : startIndex + recordsPerPage;
            const pageEmployees = filteredEmployees.slice(startIndex, endIndex);
            
            if (pageEmployees.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-12 text-center text-gray-500">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-users text-4xl text-gray-300 mb-4"></i>
                                <p class="text-lg font-medium">هیچ کارمندی یافت نشد</p>
                                <p class="text-sm">فیلترها را تغییر دهید یا کارمند جدید اضافه کنید</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            pageEmployees.forEach((employee, index) => {
                const actualIndex = employees.indexOf(employee);
                const row = document.createElement('tr');
                row.className = 'table-row hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-200';
                
                const statusBadge = getStatusBadge(employee.status || 'active');
                
                row.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="w-10 h-10 gradient-primary rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${employee.name}</div>
                                <div class="text-sm text-gray-500">${employee.email || 'ایمیل ثبت نشده'}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-sm font-mono text-gray-900">${employee.code}</td>
                    <td class="px-6 py-4 text-sm font-mono text-gray-900">${employee.nationalId}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${new Date(employee.joinDate).toLocaleDateString('fa-IR')}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${employee.position}</td>
                    <td class="px-6 py-4 text-sm">${getEmployeeDepartmentBadges(employee.code)}</td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex items-center justify-center space-x-2 space-x-reverse">
                            <button onclick="showEmployeeDetails(${actualIndex})" class="text-blue-600 hover:text-blue-800 hover:bg-blue-100 p-2 rounded-lg transition-all" title="مشاهده جزئیات">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="showEditEmployeeModal(${actualIndex})" class="text-green-600 hover:text-green-800 hover:bg-green-100 p-2 rounded-lg transition-all" title="ویرایش">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteEmployee(${actualIndex})" class="text-red-600 hover:text-red-800 hover:bg-red-100 p-2 rounded-lg transition-all" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updatePagination();
            updateRecordsInfo();
        }

        function filterEmployeesList() {
            const searchTerm = document.getElementById('employeeSearch').value.toLowerCase();
            const departmentFilter = document.getElementById('departmentFilter').value;
            const positionFilter = document.getElementById('positionFilter').value;
            
            let filtered = employees.filter(employee => {
                const matchesSearch = !searchTerm || 
                    employee.name.toLowerCase().includes(searchTerm) ||
                    employee.code.toLowerCase().includes(searchTerm) ||
                    employee.nationalId.includes(searchTerm);
                
                const matchesDepartment = !departmentFilter || 
                    departments[departmentFilter].manager === employee.code ||
                    departments[departmentFilter].employees.includes(employee.code);
                
                const matchesPosition = !positionFilter || 
                    employee.position.includes(positionFilter);
                
                return matchesSearch && matchesDepartment && matchesPosition;
            });
            
            // Apply sorting
            if (sortColumn) {
                filtered.sort((a, b) => {
                    let aVal = a[sortColumn] || '';
                    let bVal = b[sortColumn] || '';
                    
                    if (sortColumn === 'joinDate') {
                        aVal = new Date(aVal);
                        bVal = new Date(bVal);
                    }
                    
                    if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            
            return filtered;
        }

        function filterEmployees() {
            currentPage = 1;
            updateEmployeesTable();
        }

        function sortTable(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            updateEmployeesTable();
            
            // Update sort indicators
            document.querySelectorAll('th i.fas').forEach(icon => {
                icon.className = 'fas fa-sort text-gray-400';
            });
            
            const currentHeader = document.querySelector(`th[onclick="sortTable('${column}')"] i`);
            if (currentHeader) {
                currentHeader.className = `fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} text-blue-500`;
            }
        }

        function updateTablePagination() {
            recordsPerPage = parseInt(document.getElementById('recordsPerPage').value);
            currentPage = 1;
            updateEmployeesTable();
        }

        function updatePagination() {
            const totalRecords = filteredEmployees.length;
            const totalPages = recordsPerPage === 100 ? 1 : Math.ceil(totalRecords / recordsPerPage);
            const paginationContainer = document.getElementById('paginationControls');
            
            paginationContainer.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = `px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                currentPage === 1 
                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                    : 'bg-white text-gray-700 hover:bg-blue-50 hover:text-blue-600'
            }`;
            prevBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    updateEmployeesTable();
                }
            };
            paginationContainer.appendChild(prevBtn);
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                    i === currentPage 
                        ? 'bg-blue-600 text-white' 
                        : 'bg-white text-gray-700 hover:bg-blue-50 hover:text-blue-600'
                }`;
                pageBtn.textContent = i;
                pageBtn.onclick = () => {
                    currentPage = i;
                    updateEmployeesTable();
                };
                paginationContainer.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = `px-3 py-2 rounded-lg text-sm font-medium transition-all ${
                currentPage === totalPages 
                    ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                    : 'bg-white text-gray-700 hover:bg-blue-50 hover:text-blue-600'
            }`;
            nextBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    updateEmployeesTable();
                }
            };
            paginationContainer.appendChild(nextBtn);
        }

        function updateRecordsInfo() {
            const totalRecords = filteredEmployees.length;
            const startRecord = totalRecords === 0 ? 0 : (currentPage - 1) * recordsPerPage + 1;
            const endRecord = recordsPerPage === 100 ? totalRecords : Math.min(currentPage * recordsPerPage, totalRecords);
            
            document.getElementById('recordsInfo').textContent = `${startRecord}-${endRecord} از ${totalRecords}`;
        }

        function updateEmployeeStats() {
            const total = employees.length;
            const managers = Object.values(departments).filter(dept => dept.manager).length;
            const active = employees.filter(emp => (emp.status || 'active') === 'active').length;
            const newest = employees.length > 0 ? employees[employees.length - 1].name : '-';
            
            document.getElementById('totalEmployeesCount').textContent = total;
            document.getElementById('statsTotal').textContent = total;
            document.getElementById('statsManagers').textContent = managers;
            document.getElementById('statsActive').textContent = active;
            document.getElementById('statsNewest').textContent = newest;
        }

        function deleteEmployee(index) {
            const employee = employees[index];
            
            if (confirm(`آیا از حذف کارمند "${employee.name}" اطمینان دارید؟\n\nاین عمل غیرقابل بازگشت است.`)) {
                // Remove from departments
                for (let dept in departments) {
                    if (departments[dept].manager === employee.code) {
                        departments[dept].manager = '';
                    }
                    departments[dept].employees = departments[dept].employees.filter(code => code !== employee.code);
                }
                
                employees.splice(index, 1);
                updateEmployeesTable();
                updateEmployeeSelects();
                updateEmployeeStats();
                showNotification('کارمند با موفقیت حذف شد', 'success');
            }
        }

        function exportEmployees(format) {
            const data = filteredEmployees.map(emp => ({
                'نام و نام خانوادگی': emp.name,
                'کد پرسنلی': emp.code,
                'کد ملی': emp.nationalId,
                'تاریخ ورود': emp.joinDate,
                'سمت': emp.position,
                'شماره تماس': emp.phone || '',
                'ایمیل': emp.email || '',
                'وضعیت': getStatusText(emp.status || 'active')
            }));
            
            showNotification(`در حال تولید فایل ${format.toUpperCase()}...`, 'info');
            
            // Simulate export process
            setTimeout(() => {
                showNotification(`فایل ${format.toUpperCase()} با موفقیت تولید شد`, 'success');
            }, 1500);
        }

        function getStatusText(status) {
            const statusTexts = {
                'active': 'فعال',
                'inactive': 'غیرفعال',
                'suspended': 'تعلیق',
                'terminated': 'اخراج'
            };
            return statusTexts[status] || 'فعال';
        }

        function getEmployeeDepartment(employeeCode) {
            for (let dept in departments) {
                if (departments[dept].manager === employeeCode || departments[dept].employees.includes(employeeCode)) {
                    return getDepartmentName(dept);
                }
            }
            return 'نامشخص';
        }

        function getEmployeeDepartmentBadges(employeeCode) {
            let badges = [];
            for (let dept in departments) {
                if (departments[dept].manager === employeeCode) {
                    badges.push(`<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 ml-1">مسئول ${getDepartmentName(dept)}</span>`);
                } else if (departments[dept].employees.includes(employeeCode)) {
                    badges.push(`<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 ml-1">${getDepartmentName(dept)}</span>`);
                }
            }
            return badges.length > 0 ? badges.join(' ') : '<span class="text-gray-400">نامشخص</span>';
        }

        function addRealtimeActivity(activity) {
            realtimeActivities.unshift({
                ...activity,
                timestamp: new Date(),
                id: Date.now()
            });
            
            // Keep only last 20 activities
            if (realtimeActivities.length > 20) {
                realtimeActivities = realtimeActivities.slice(0, 20);
            }
            
            updateRealtimeDisplay();
        }

        function updateRealtimeDisplay() {
            const container = document.getElementById('realtimeActivity');
            if (!container) return;
            
            container.innerHTML = '';
            
            realtimeActivities.forEach(activity => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-3 space-x-reverse p-4 hover:bg-white/50 rounded-xl transition-all cursor-pointer';
                
                const timeAgo = getTimeAgo(activity.timestamp);
                
                div.innerHTML = `
                    <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse shadow-glow"></div>
                    <div class="flex-1">
                        <p class="text-sm font-semibold text-gray-800">${activity.employee}</p>
                        <p class="text-xs text-gray-600">${activity.action}</p>
                        <p class="text-xs text-gray-400 mt-1">${timeAgo}</p>
                    </div>
                    <div class="text-green-500">
                        <i class="fas fa-check-circle"></i>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function getTimeAgo(timestamp) {
            const now = new Date();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'همین الان';
            if (minutes < 60) return `${minutes} دقیقه پیش`;
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} ساعت پیش`;
            
            const days = Math.floor(hours / 24);
            return `${days} روز پیش`;
        }

        function updateTopPerformers() {
            // Calculate performance scores for each employee
            topPerformersData = [];
            
            employees.forEach(employee => {
                let totalScore = 0;
                let metricsCount = 0;
                
                for (let dept in departments) {
                    if (departments[dept].manager === employee.code || departments[dept].employees.includes(employee.code)) {
                        departments[dept].metrics.forEach(metric => {
                            if (metric.target > 0) {
                                totalScore += (metric.current / metric.target) * 100;
                                metricsCount++;
                            }
                        });
                    }
                }
                
                if (metricsCount > 0) {
                    topPerformersData.push({
                        name: employee.name,
                        code: employee.code,
                        score: Math.round(totalScore / metricsCount),
                        department: getEmployeeDepartment(employee.code)
                    });
                }
            });
            
            // Sort by score and take top 5
            topPerformersData.sort((a, b) => b.score - a.score);
            topPerformersData = topPerformersData.slice(0, 5);
            
            updateTopPerformersDisplay();
        }

        function updateTopPerformersDisplay() {
            const container = document.getElementById('topPerformers');
            if (!container) return;
            
            container.innerHTML = '';
            
            topPerformersData.forEach((performer, index) => {
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-4 rounded-xl transition-all hover-lift ${
                    index === 0 ? 'gradient-primary text-white shadow-glow' : 'bg-white/50'
                }`;
                
                const textColor = index === 0 ? 'text-white' : 'text-gray-800';
                const badgeColor = index === 0 ? 'bg-white/20 text-white' : 'bg-blue-100 text-blue-800';
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-10 h-10 rounded-full ${index === 0 ? 'bg-white/20' : 'gradient-primary'} text-white flex items-center justify-center text-sm font-bold shadow-elegant">
                            ${index + 1}
                        </div>
                        <div>
                            <p class="font-bold ${textColor}">${performer.name}</p>
                            <p class="text-xs ${index === 0 ? 'text-white/80' : 'text-gray-600'}">${performer.department}</p>
                        </div>
                    </div>
                    <div class="text-left">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="font-bold text-2xl ${performer.score >= 90 ? 'text-green-400' : performer.score >= 70 ? 'text-yellow-400' : 'text-red-400'}">${performer.score}%</span>
                            <i class="fas ${performer.score >= 90 ? 'fa-trophy text-yellow-400' : performer.score >= 70 ? 'fa-medal text-gray-400' : 'fa-chart-line text-blue-400'}"></i>
                        </div>
                        <p class="text-xs ${index === 0 ? 'text-white/80' : 'text-gray-500'}">عملکرد</p>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function getDepartmentName(dept) {
            const names = {
                marketing: 'بازاریابی',
                collection: 'وصول مطالبات',
                pos: 'پایانه فروشگاهی',
                modern: 'خدمات مدرن',
                evaluation: 'کاربرگ ارزیابی'
            };
            return names[dept] || dept;
        }

        // Enhanced Department Management
        let currentDepartmentForAdding = null;
        let selectedEmployeesForDepartment = [];

        function updateEmployeeSelects() {
            const selects = [
                'marketingManager', 'collectionManager', 'posManager', 'modernManager', 'evaluationManager',
                'analysisEmployee'
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">انتخاب کنید</option>';
                    
                    employees.forEach(employee => {
                        const option = document.createElement('option');
                        option.value = employee.code;
                        option.textContent = employee.name;
                        select.appendChild(option);
                    });
                }
            });
            
            // Update department employee lists
            updateDepartmentEmployeeLists();
        }

        function updateDepartmentEmployeeLists() {
            const departmentNames = ['marketing', 'collection', 'pos', 'modern', 'evaluation'];
            
            departmentNames.forEach(dept => {
                const container = document.getElementById(`${dept}EmployeesList`);
                if (container) {
                    container.innerHTML = '';
                    
                    const deptEmployees = departments[dept].employees;
                    const manager = departments[dept].manager;
                    
                    // Add manager if exists
                    if (manager) {
                        const managerEmployee = employees.find(emp => emp.code === manager);
                        if (managerEmployee) {
                            const managerDiv = document.createElement('div');
                            managerDiv.className = 'flex items-center justify-between p-3 bg-blue-100 rounded-xl border-2 border-blue-200';
                            managerDiv.innerHTML = `
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-crown text-white text-xs"></i>
                                    </div>
                                    <div>
                                        <p class="font-bold text-blue-800">${managerEmployee.name}</p>
                                        <p class="text-xs text-blue-600">مسئول بخش</p>
                                    </div>
                                </div>
                                <button onclick="removeManagerFromDepartment('${dept}')" class="text-red-500 hover:text-red-700 hover:bg-red-100 p-1 rounded-lg transition-all">
                                    <i class="fas fa-times text-sm"></i>
                                </button>
                            `;
                            container.appendChild(managerDiv);
                        }
                    }
                    
                    // Add regular employees
                    deptEmployees.forEach(empCode => {
                        const employee = employees.find(emp => emp.code === empCode);
                        if (employee) {
                            const empDiv = document.createElement('div');
                            empDiv.className = 'flex items-center justify-between p-3 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all';
                            empDiv.innerHTML = `
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user text-white text-xs"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800">${employee.name}</p>
                                        <p class="text-xs text-gray-600">${employee.position}</p>
                                    </div>
                                </div>
                                <button onclick="removeEmployeeFromDepartment('${dept}', '${empCode}')" class="text-red-500 hover:text-red-700 hover:bg-red-100 p-1 rounded-lg transition-all">
                                    <i class="fas fa-times text-sm"></i>
                                </button>
                            `;
                            container.appendChild(empDiv);
                        }
                    });
                    
                    // Show empty state if no employees
                    if (!manager && deptEmployees.length === 0) {
                        container.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">هیچ کارمندی تخصیص داده نشده است</p>';
                    }
                }
                
                // Update counts
                const totalCount = (manager ? 1 : 0) + deptEmployees.length;
                const activeCount = deptEmployees.filter(empCode => {
                    const emp = employees.find(e => e.code === empCode);
                    return emp && (emp.status || 'active') === 'active';
                }).length + (manager ? 1 : 0);
                
                const countElement = document.getElementById(`${dept}Count`);
                const activeCountElement = document.getElementById(`${dept}ActiveCount`);
                
                if (countElement) countElement.textContent = totalCount;
                if (activeCountElement) activeCountElement.textContent = activeCount;
            });
        }

        function showAddEmployeeToDepartment(department) {
            currentDepartmentForAdding = department;
            selectedEmployeesForDepartment = [];
            
            const modal = document.getElementById('addEmployeeToDepartmentModal');
            const title = document.getElementById('addToDepartmentModalTitle');
            
            title.textContent = `افزودن کارمند به بخش ${getDepartmentName(department)}`;
            
            updateAvailableEmployeesList();
            updateSelectedEmployeesList();
            
            modal.style.display = 'flex';
        }

        function hideAddEmployeeToDepartmentModal() {
            document.getElementById('addEmployeeToDepartmentModal').style.display = 'none';
            currentDepartmentForAdding = null;
            selectedEmployeesForDepartment = [];
        }

        function updateAvailableEmployeesList() {
            const container = document.getElementById('availableEmployeesList');
            container.innerHTML = '';
            
            if (!currentDepartmentForAdding) return;
            
            const dept = departments[currentDepartmentForAdding];
            const assignedEmployees = [...dept.employees];
            if (dept.manager) assignedEmployees.push(dept.manager);
            
            const availableEmployees = employees.filter(emp => 
                !assignedEmployees.includes(emp.code) && 
                !selectedEmployeesForDepartment.includes(emp.code)
            );
            
            if (availableEmployees.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">همه کارمندان تخصیص داده شده‌اند</p>';
                return;
            }
            
            availableEmployees.forEach(employee => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-white rounded-xl border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all cursor-pointer';
                div.onclick = () => selectEmployeeForDepartment(employee.code);
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-10 h-10 gradient-primary rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">${employee.name}</p>
                            <p class="text-sm text-gray-600">${employee.position}</p>
                            <p class="text-xs text-gray-500">کد: ${employee.code}</p>
                        </div>
                    </div>
                    <div class="text-blue-500">
                        <i class="fas fa-plus-circle text-xl"></i>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function updateSelectedEmployeesList() {
            const container = document.getElementById('selectedEmployeesList');
            container.innerHTML = '';
            
            if (selectedEmployeesForDepartment.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm text-center">هیچ کارمندی انتخاب نشده است</p>';
                return;
            }
            
            selectedEmployeesForDepartment.forEach(empCode => {
                const employee = employees.find(emp => emp.code === empCode);
                if (employee) {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-3 bg-white rounded-xl border border-green-200';
                    
                    div.innerHTML = `
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-white text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800">${employee.name}</p>
                                <p class="text-sm text-gray-600">${employee.position}</p>
                            </div>
                        </div>
                        <button onclick="deselectEmployeeForDepartment('${empCode}')" class="text-red-500 hover:text-red-700 hover:bg-red-100 p-1 rounded-lg transition-all">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    container.appendChild(div);
                }
            });
        }

        function selectEmployeeForDepartment(employeeCode) {
            if (!selectedEmployeesForDepartment.includes(employeeCode)) {
                selectedEmployeesForDepartment.push(employeeCode);
                updateAvailableEmployeesList();
                updateSelectedEmployeesList();
            }
        }

        function deselectEmployeeForDepartment(employeeCode) {
            selectedEmployeesForDepartment = selectedEmployeesForDepartment.filter(code => code !== employeeCode);
            updateAvailableEmployeesList();
            updateSelectedEmployeesList();
        }

        function confirmAddEmployeesToDepartment() {
            if (!currentDepartmentForAdding || selectedEmployeesForDepartment.length === 0) {
                showNotification('لطفاً حداقل یک کارمند انتخاب کنید', 'error');
                return;
            }
            
            // Add selected employees to department
            selectedEmployeesForDepartment.forEach(empCode => {
                if (!departments[currentDepartmentForAdding].employees.includes(empCode)) {
                    departments[currentDepartmentForAdding].employees.push(empCode);
                }
            });
            
            updateDepartmentEmployeeLists();
            updateDashboardMetrics();
            hideAddEmployeeToDepartmentModal();
            
            showNotification(`${selectedEmployeesForDepartment.length} کارمند به بخش ${getDepartmentName(currentDepartmentForAdding)} اضافه شد`, 'success');
        }

        function removeEmployeeFromDepartment(department, employeeCode) {
            const employee = employees.find(emp => emp.code === employeeCode);
            const departmentName = getDepartmentName(department);
            
            if (confirm(`آیا از حذف "${employee.name}" از بخش "${departmentName}" اطمینان دارید؟`)) {
                departments[department].employees = departments[department].employees.filter(code => code !== employeeCode);
                updateDepartmentEmployeeLists();
                updateDashboardMetrics();
                showNotification(`کارمند از بخش ${departmentName} حذف شد`, 'success');
            }
        }

        function removeManagerFromDepartment(department) {
            const manager = employees.find(emp => emp.code === departments[department].manager);
            const departmentName = getDepartmentName(department);
            
            if (confirm(`آیا از حذف "${manager.name}" از مسئولیت بخش "${departmentName}" اطمینان دارید؟`)) {
                departments[department].manager = '';
                updateDepartmentEmployeeLists();
                updateEmployeeSelects();
                updateDashboardMetrics();
                showNotification(`مسئول بخش ${departmentName} حذف شد`, 'success');
            }
        }

        function resetDepartmentAssignments() {
            if (confirm('آیا از بازنشانی تمام تخصیص‌های بخش‌ها اطمینان دارید؟\n\nاین عمل تمام تخصیص‌ها را پاک خواهد کرد.')) {
                for (let dept in departments) {
                    departments[dept].manager = '';
                    departments[dept].employees = [];
                }
                
                updateDepartmentEmployeeLists();
                updateEmployeeSelects();
                updateDashboardMetrics();
                showNotification('تمام تخصیص‌های بخش‌ها بازنشانی شد', 'success');
            }
        }

        // Add user menu toggle function
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            if (menu) {
                menu.classList.toggle('hidden');
            }
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('userMenu');
            const userMenuButton = event.target.closest('[onclick="toggleUserMenu()"]');
            
            if (userMenu && !userMenuButton && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });

        function saveDepartmentAssignments() {
            // Save managers
            departments.marketing.manager = document.getElementById('marketingManager').value;
            departments.collection.manager = document.getElementById('collectionManager').value;
            departments.pos.manager = document.getElementById('posManager').value;
            departments.modern.manager = document.getElementById('modernManager').value;
            departments.evaluation.manager = document.getElementById('evaluationManager').value;
            
            // Save employees
            departments.marketing.employees = Array.from(document.getElementById('marketingEmployees').selectedOptions).map(opt => opt.value);
            departments.collection.employees = Array.from(document.getElementById('collectionEmployees').selectedOptions).map(opt => opt.value);
            departments.pos.employees = Array.from(document.getElementById('posEmployees').selectedOptions).map(opt => opt.value);
            departments.modern.employees = Array.from(document.getElementById('modernEmployees').selectedOptions).map(opt => opt.value);
            departments.evaluation.employees = Array.from(document.getElementById('evaluationEmployees').selectedOptions).map(opt => opt.value);
            
            // Add sample customers
            customers = [
                {
                    id: 1001,
                    name: 'شرکت پتروشیمی آریا',
                    type: 'حقوقی',
                    field: 'پتروشیمی',
                    experience: 15,
                    address: 'تبریز، شهرک صنعتی',
                    referrer: 'اتاق بازرگانی',
                    guarantee: 'دارد',
                    resources: 'منابع مالی قوی، سرمایه گذاری خارجی',
                    priority: 'بسیار بالا',
                    notes: 'مشتری استراتژیک',
                    activityTypes: { currency: true, rial: true, commitment: false },
                    createdAt: new Date(),
                    marketingProgress: {
                        firstMeeting: { completed: true, date: new Date('2024-01-15'), notes: 'جلسه اولیه برگزار شد', progress: 100 },
                        accountOpening: { completed: true, date: new Date('2024-02-01'), notes: 'حساب‌های ارزی و ریالی افتتاح شد', progress: 100 },
                        resourceTransfer: { completed: false, date: null, notes: '', progress: 60 },
                        facilities: { completed: false, date: null, notes: '', progress: 30 },
                        currencyActivities: { completed: false, date: null, notes: '', progress: 20 },
                        businessExpansion: { completed: false, date: null, notes: '', progress: 0 },
                        modernServices: { completed: false, date: null, notes: '', progress: 0 },
                        welfareAgreement: { completed: false, date: null, notes: '', progress: 0 }
                    }
                },
                {
                    id: 1002,
                    name: 'احمد رضایی',
                    type: 'حقیقی',
                    field: 'تجارت',
                    experience: 8,
                    address: 'تبریز، خیابان امام',
                    referrer: 'مشتری قدیمی',
                    guarantee: 'در حال بررسی',
                    resources: 'منابع متوسط',
                    priority: 'بالا',
                    notes: 'تاجر فعال در بازار',
                    activityTypes: { currency: false, rial: true, commitment: true },
                    createdAt: new Date(),
                    marketingProgress: {
                        firstMeeting: { completed: true, date: new Date('2024-02-10'), notes: 'آشنایی اولیه', progress: 100 },
                        accountOpening: { completed: false, date: null, notes: '', progress: 40 },
                        resourceTransfer: { completed: false, date: null, notes: '', progress: 0 },
                        facilities: { completed: false, date: null, notes: '', progress: 0 },
                        currencyActivities: { completed: false, date: null, notes: '', progress: 0 },
                        businessExpansion: { completed: false, date: null, notes: '', progress: 0 },
                        modernServices: { completed: false, date: null, notes: '', progress: 0 },
                        welfareAgreement: { completed: false, date: null, notes: '', progress: 0 }
                    }
                }
            ];
            
            updateEmployeesTable();
            updateDashboardMetrics();
            updateEmployeeStats();
            showNotification('تخصیص‌ها با موفقیت ذخیره شد', 'success');
        }

        // Goals and Metrics Management
        function saveGoals() {
            const dept = document.getElementById('goalDepartment').value;
            const monthly = document.getElementById('monthlyGoal').value;
            const yearly = document.getElementById('yearlyGoal').value;
            
            departments[dept].goals.monthly = parseInt(monthly) || 0;
            departments[dept].goals.yearly = parseInt(yearly) || 0;
            
            document.getElementById('monthlyGoal').value = '';
            document.getElementById('yearlyGoal').value = '';
            
            showNotification('اهداف با موفقیت ذخیره شد', 'success');
        }

        function addMetric() {
            const dept = document.getElementById('metricDepartment').value;
            const name = document.getElementById('metricName').value;
            const target = document.getElementById('metricTarget').value;
            
            if (name && target) {
                departments[dept].metrics.push({
                    name: name,
                    target: parseInt(target),
                    current: 0
                });
                
                document.getElementById('metricName').value = '';
                document.getElementById('metricTarget').value = '';
                
                updateMetricsList();
                showNotification('شاخص جدید اضافه شد', 'success');
            }
        }

        function updateMetricsList() {
            const container = document.getElementById('metricsList');
            container.innerHTML = '';
            
            for (let dept in departments) {
                departments[dept].metrics.forEach((metric, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl hover-lift';
                    div.innerHTML = `
                        <div class="flex items-center space-x-4 space-x-reverse">
                            <div class="w-12 h-12 gradient-primary rounded-full flex items-center justify-center">
                                <i class="fas fa-chart-bar text-white"></i>
                            </div>
                            <div>
                                <span class="font-bold text-gray-800">${metric.name}</span>
                                <div class="flex items-center space-x-4 space-x-reverse mt-1">
                                    <span class="text-sm text-blue-600 bg-blue-100 px-2 py-1 rounded-full">${getDepartmentName(dept)}</span>
                                    <span class="text-sm text-gray-600">هدف: ${metric.target.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="deleteMetric('${dept}', ${index})" class="text-red-600 hover:text-red-800 hover:bg-red-100 p-2 rounded-lg transition-all">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function deleteMetric(dept, index) {
            if (confirm('آیا از حذف این شاخص اطمینان دارید؟')) {
                departments[dept].metrics.splice(index, 1);
                updateMetricsList();
                showNotification('شاخص با موفقیت حذف شد', 'success');
            }
        }

        // Reports and Analytics
        function updateReportsSection() {
            updateEmployeeSelects();
        }

        function updateDashboardMetrics() {
            // Update department counts
            document.getElementById('marketingCount').textContent = departments.marketing.employees.length;
            document.getElementById('collectionCount').textContent = departments.collection.employees.length;
            document.getElementById('posCount').textContent = departments.pos.employees.length;
            document.getElementById('modernCount').textContent = departments.modern.employees.length;
            document.getElementById('evaluationCount').textContent = departments.evaluation.employees.length;
            
            updateTopPerformers();
            updateRealtimeDisplay();
        }

        function loadSampleData() {
            // Add comprehensive sample employees with clear login credentials and enhanced data
            employees = [
                { 
                    name: 'علی احمدی', 
                    code: '1001', 
                    nationalId: '1111111111', 
                    joinDate: '2023-01-15', 
                    position: 'کارشناس بازاریابی',
                    phone: '09123456789',
                    email: 'ali.ahmadi@bankshahr.ir',
                    address: 'تبریز، خیابان امام خمینی، پلاک 123',
                    accessLevel: 'employee',
                    salary: 15000000,
                    status: 'active',
                    notes: 'کارمند نمونه در بخش بازاریابی با عملکرد عالی'
                },
                { 
                    name: 'فاطمه محمدی', 
                    code: '1002', 
                    nationalId: '2222222222', 
                    joinDate: '2023-02-20', 
                    position: 'کارشناس وصول',
                    phone: '09123456790',
                    email: 'fatemeh.mohammadi@bankshahr.ir',
                    address: 'تبریز، خیابان ولیعصر، پلاک 456',
                    accessLevel: 'employee',
                    salary: 14500000,
                    status: 'active',
                    notes: 'متخصص در امور وصول مطالبات'
                },
                { 
                    name: 'حسن رضایی', 
                    code: '1003', 
                    nationalId: '3333333333', 
                    joinDate: '2023-03-10', 
                    position: 'کارشناس POS',
                    phone: '09123456791',
                    email: 'hassan.rezaei@bankshahr.ir',
                    address: 'تبریز، خیابان شهید بهشتی، پلاک 789',
                    accessLevel: 'supervisor',
                    salary: 16000000,
                    status: 'active',
                    notes: 'مسئول نصب و راه‌اندازی دستگاه‌های POS'
                },
                { 
                    name: 'مریم کریمی', 
                    code: '1004', 
                    nationalId: '4444444444', 
                    joinDate: '2023-04-05', 
                    position: 'کارشناس خدمات مدرن',
                    phone: '09123456792',
                    email: 'maryam.karimi@bankshahr.ir',
                    address: 'تبریز، خیابان آزادی، پلاک 321',
                    accessLevel: 'employee',
                    salary: 15500000,
                    status: 'active',
                    notes: 'متخصص در خدمات بانکداری الکترونیک'
                },
                { 
                    name: 'محمد صادقی', 
                    code: '1005', 
                    nationalId: '5555555555', 
                    joinDate: '2023-05-12', 
                    position: 'کارشناس ارزیابی',
                    phone: '09123456793',
                    email: 'mohammad.sadeghi@bankshahr.ir',
                    address: 'تبریز، خیابان فردوسی، پلاک 654',
                    accessLevel: 'employee',
                    salary: 14000000,
                    status: 'active',
                    notes: 'مسئول ارزیابی عملکرد و تهیه گزارشات'
                },
                { 
                    name: 'زهرا نوری', 
                    code: '1006', 
                    nationalId: '6666666666', 
                    joinDate: '2023-06-01', 
                    position: 'مسئول بخش',
                    phone: '09123456794',
                    email: 'zahra.nouri@bankshahr.ir',
                    address: 'تبریز، خیابان سعدی، پلاک 987',
                    accessLevel: 'manager',
                    salary: 20000000,
                    status: 'active',
                    notes: 'مدیر بخش بازاریابی با سابقه 8 سال'
                },
                { 
                    name: 'رضا کاظمی', 
                    code: '1007', 
                    nationalId: '7777777777', 
                    joinDate: '2023-07-10', 
                    position: 'مسئول بخش',
                    phone: '09123456795',
                    email: 'reza.kazemi@bankshahr.ir',
                    address: 'تبریز، خیابان حافظ، پلاک 147',
                    accessLevel: 'manager',
                    salary: 19500000,
                    status: 'active',
                    notes: 'مدیر بخش وصول مطالبات'
                },
                { 
                    name: 'سارا حسینی', 
                    code: '1008', 
                    nationalId: '8888888888', 
                    joinDate: '2023-08-15', 
                    position: 'کارشناس ارشد',
                    phone: '09123456796',
                    email: 'sara.hosseini@bankshahr.ir',
                    address: 'تبریز، خیابان مولوی، پلاک 258',
                    accessLevel: 'supervisor',
                    salary: 17000000,
                    status: 'active',
                    notes: 'کارشناس ارشد با تخصص در امور مالی'
                },
                { 
                    name: 'امیر تبریزی', 
                    code: '1009', 
                    nationalId: '9999999999', 
                    joinDate: '2023-09-20', 
                    position: 'کارشناس فنی',
                    phone: '09123456797',
                    email: 'amir.tabrizi@bankshahr.ir',
                    address: 'تبریز، خیابان شریعتی، پلاک 369',
                    accessLevel: 'employee',
                    salary: 16500000,
                    status: 'active',
                    notes: 'متخصص فنی سیستم‌های بانکی'
                },
                { 
                    name: 'لیلا اصفهانی', 
                    code: '1010', 
                    nationalId: '1010101010', 
                    joinDate: '2023-10-05', 
                    position: 'کارشناس پشتیبانی',
                    phone: '09123456798',
                    email: 'leila.esfahani@bankshahr.ir',
                    address: 'تبریز، خیابان انقلاب، پلاک 741',
                    accessLevel: 'employee',
                    salary: 13500000,
                    status: 'active',
                    notes: 'مسئول پشتیبانی فنی و راهنمایی مشتریان'
                }
            ];
            
            console.log('✅ Sample employees loaded:');
            employees.forEach(emp => {
                console.log(`👤 ${emp.name} - کد: ${emp.code} - ملی: ${emp.nationalId}`);
            });
            
            // Add sample activities
            addRealtimeActivity({
                employee: 'علی احمدی',
                action: 'ثبت فعالیت بازاریابی جدید'
            });
            
            addRealtimeActivity({
                employee: 'فاطمه محمدی',
                action: 'بروزرسانی اطلاعات مشتری'
            });
            
            // Add sample customers
            customers = [
                {
                    id: 1001,
                    name: 'شرکت پتروشیمی آریا',
                    type: 'حقوقی',
                    field: 'پتروشیمی',
                    experience: 15,
                    address: 'تبریز، شهرک صنعتی',
                    referrer: 'اتاق بازرگانی',
                    guarantee: 'دارد',
                    resources: 'منابع مالی قوی، سرمایه گذاری خارجی',
                    priority: 'بسیار بالا',
                    notes: 'مشتری استراتژیک',
                    activityTypes: { currency: true, rial: true, commitment: false },
                    createdAt: new Date(),
                    marketingProgress: {
                        firstMeeting: { completed: true, date: new Date('2024-01-15'), notes: 'جلسه اولیه برگزار شد', progress: 100 },
                        accountOpening: { completed: true, date: new Date('2024-02-01'), notes: 'حساب‌های ارزی و ریالی افتتاح شد', progress: 100 },
                        resourceTransfer: { completed: false, date: null, notes: '', progress: 60 },
                        facilities: { completed: false, date: null, notes: '', progress: 30 },
                        currencyActivities: { completed: false, date: null, notes: '', progress: 20 },
                        businessExpansion: { completed: false, date: null, notes: '', progress: 0 },
                        modernServices: { completed: false, date: null, notes: '', progress: 0 },
                        welfareAgreement: { completed: false, date: null, notes: '', progress: 0 }
                    }
                },
                {
                    id: 1002,
                    name: 'احمد رضایی',
                    type: 'حقیقی',
                    field: 'تجارت',
                    experience: 8,
                    address: 'تبریز، خیابان امام',
                    referrer: 'مشتری قدیمی',
                    guarantee: 'در حال بررسی',
                    resources: 'منابع متوسط',
                    priority: 'بالا',
                    notes: 'تاجر فعال در بازار',
                    activityTypes: { currency: false, rial: true, commitment: true },
                    createdAt: new Date(),
                    marketingProgress: {
                        firstMeeting: { completed: true, date: new Date('2024-02-10'), notes: 'آشنایی اولیه', progress: 100 },
                        accountOpening: { completed: false, date: null, notes: '', progress: 40 },
                        resourceTransfer: { completed: false, date: null, notes: '', progress: 0 },
                        facilities: { completed: false, date: null, notes: '', progress: 0 },
                        currencyActivities: { completed: false, date: null, notes: '', progress: 0 },
                        businessExpansion: { completed: false, date: null, notes: '', progress: 0 },
                        modernServices: { completed: false, date: null, notes: '', progress: 0 },
                        welfareAgreement: { completed: false, date: null, notes: '', progress: 0 }
                    }
                }
            ];
            
            updateEmployeesTable();
            updateDashboardMetrics();
            updateEmployeeStats();
        }

        function initializeCharts() {
            // Initialize charts when DOM is ready
            setTimeout(() => {
                try {
                    if (typeof Chart !== 'undefined') {
                        console.log('✅ Chart.js loaded successfully');
                        createMonthlyChart();
                        createEmployeeChart();
                    } else {
                        console.log('⚠️ Chart.js not loaded, retrying...');
                        // Retry after another delay
                        setTimeout(() => {
                            if (typeof Chart !== 'undefined') {
                                createMonthlyChart();
                                createEmployeeChart();
                            } else {
                                console.log('❌ Chart.js failed to load');
                            }
                        }, 1000);
                    }
                } catch (error) {
                    console.log('❌ Chart initialization error:', error);
                }
            }, 1000);
        }

        function createMonthlyChart() {
            const ctx = document.getElementById('monthlyChart');
            if (!ctx) {
                console.log('❌ Monthly chart canvas not found');
                return;
            }
            
            try {
                if (typeof Chart === 'undefined') {
                    console.log('❌ Chart.js not available for monthly chart');
                    return;
                }
                
                console.log('📊 Creating monthly chart...');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور'],
                        datasets: [{
                            label: 'بازاریابی',
                            data: [65, 59, 80, 81, 56, 55],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'وصول مطالبات',
                            data: [28, 48, 40, 19, 86, 27],
                            borderColor: '#4facfe',
                            backgroundColor: 'rgba(79, 172, 254, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                console.log('✅ Monthly chart created successfully');
            } catch (error) {
                console.log('❌ Monthly chart creation failed:', error.message);
                // Show fallback content
                ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-64 text-gray-500"><i class="fas fa-chart-line text-4xl"></i><span class="mr-3">نمودار در حال بارگذاری...</span></div>';
            }
        }

        function createEmployeeChart() {
            const ctx = document.getElementById('employeeChart');
            if (!ctx) {
                console.log('❌ Employee chart canvas not found');
                return;
            }
            
            try {
                if (typeof Chart === 'undefined') {
                    console.log('❌ Chart.js not available for employee chart');
                    return;
                }
                
                console.log('📊 Creating employee chart...');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['بازاریابی', 'وصول مطالبات', 'POS', 'خدمات مدرن', 'ارزیابی'],
                        datasets: [{
                            data: [12, 19, 8, 15, 6],
                            backgroundColor: [
                                '#667eea',
                                '#4facfe',
                                '#43e97b',
                                '#fa709a',
                                '#764ba2'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
                console.log('✅ Employee chart created successfully');
            } catch (error) {
                console.log('❌ Employee chart creation failed:', error.message);
                // Show fallback content
                ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-64 text-gray-500"><i class="fas fa-chart-pie text-4xl"></i><span class="mr-3">نمودار در حال بارگذاری...</span></div>';
            }
        }

        // Add missing employee functions
        function loadEmployeeGoals(employee) {
            const container = document.getElementById('employeeGoals');
            if (!container) return;
            
            container.innerHTML = '<p class="text-gray-500">هیچ هدفی تخصیص داده نشده است</p>';
        }

        function loadEmployeeMetrics(employee) {
            const select = document.getElementById('actionMetric');
            if (!select) return;
            
            select.innerHTML = '<option value="">انتخاب کنید</option>';
        }

        function updateEmployeeCustomers() {
            const container = document.getElementById('assignedCustomers');
            if (!container) return;
            
            container.innerHTML = '<p class="text-gray-500">هیچ مشتری تخصیص داده نشده است</p>';
        }

        function updateEmployeeActivitiesTable() {
            const tbody = document.getElementById('employeeActivitiesTable');
            if (!tbody) return;
            
            tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">هیچ فعالیتی ثبت نشده است</td></tr>';
        }

        function submitAction() {
            showNotification('اقدام با موفقیت ثبت شد', 'success');
        }

        function submitMarketingActivity() {
            showNotification('فعالیت بازاریابی با موفقیت ثبت شد', 'success');
        }

        // Customer Management System
        function showAddCustomerModal() {
            document.getElementById('addCustomerModal').style.display = 'flex';
        }

        function hideAddCustomerModal() {
            document.getElementById('addCustomerModal').style.display = 'none';
            document.getElementById('addCustomerForm').reset();
        }

        // Add customer form event listener
        document.getElementById('addCustomerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customer = {
                name: document.getElementById('customerName').value,
                type: document.getElementById('customerType').value,
                field: document.getElementById('customerField').value,
                experience: document.getElementById('customerExperience').value,
                address: document.getElementById('customerAddress').value,
                referrer: document.getElementById('customerReferrer').value,
                guarantee: document.getElementById('customerGuarantee').value,
                resources: document.getElementById('customerResources').value,
                priority: document.getElementById('customerPriority').value,
                notes: document.getElementById('customerNotes').value,
                activityTypes: {
                    currency: document.getElementById('activityCurrency').checked,
                    rial: document.getElementById('activityRial').checked,
                    commitment: document.getElementById('activityCommitment').checked
                },
                createdAt: new Date(),
                id: Date.now(),
                marketingProgress: {
                    firstMeeting: { completed: false, date: null, notes: '', progress: 0 },
                    accountOpening: { completed: false, date: null, notes: '', progress: 0 },
                    resourceTransfer: { completed: false, date: null, notes: '', progress: 0 },
                    facilities: { completed: false, date: null, notes: '', progress: 0 },
                    currencyActivities: { completed: false, date: null, notes: '', progress: 0 },
                    businessExpansion: { completed: false, date: null, notes: '', progress: 0 },
                    modernServices: { completed: false, date: null, notes: '', progress: 0 },
                    welfareAgreement: { completed: false, date: null, notes: '', progress: 0 }
                }
            };
            
            customers.push(customer);
            updateCustomersList();
            updateCustomerSelects();
            hideAddCustomerModal();
            
            showNotification('مشتری هدف جدید با موفقیت اضافه شد', 'success');
        });

        function updateMarketingEmployeeSelect() {
            const select = document.getElementById('marketingEmployeeSelect');
            if (select) {
                select.innerHTML = '<option value="">انتخاب کنید</option>';
                employees.forEach(employee => {
                    if (departments.marketing.employees.includes(employee.code) || departments.marketing.manager === employee.code) {
                        const option = document.createElement('option');
                        option.value = employee.code;
                        option.textContent = employee.name;
                        select.appendChild(option);
                    }
                });
            }
        }

        function updateCustomersList() {
            const container = document.getElementById('customersList');
            if (!container) return;
            
            container.innerHTML = '';
            
            customers.forEach((customer, index) => {
                const activityTypesText = [];
                if (customer.activityTypes.currency) activityTypesText.push('ارزی');
                if (customer.activityTypes.rial) activityTypesText.push('ریالی');
                if (customer.activityTypes.commitment) activityTypesText.push('تعهداتی');
                
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl p-4 shadow-elegant hover-lift border border-gray-200';
                div.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <div class="w-10 h-10 gradient-primary rounded-full flex items-center justify-center">
                                <i class="fas ${customer.type === 'حقیقی' ? 'fa-user' : 'fa-building'} text-white"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800">${customer.name}</h4>
                                <p class="text-sm text-gray-600">${customer.type} - ${customer.field}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button onclick="showMarketingProgress(${index})" class="text-blue-600 hover:text-blue-800 p-2 rounded-lg hover:bg-blue-100 transition-all">
                                <i class="fas fa-chart-line"></i>
                            </button>
                            <button onclick="deleteCustomer(${index})" class="text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-100 transition-all">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">سابقه:</span>
                            <span class="font-medium">${customer.experience} سال</span>
                        </div>
                        <div>
                            <span class="text-gray-500">اولویت:</span>
                            <span class="px-2 py-1 rounded-full text-xs ${
                                customer.priority === 'بسیار بالا' ? 'bg-red-100 text-red-800' :
                                customer.priority === 'بالا' ? 'bg-orange-100 text-orange-800' :
                                'bg-gray-100 text-gray-800'
                            }">${customer.priority}</span>
                        </div>
                        <div class="col-span-2">
                            <span class="text-gray-500">فعالیت:</span>
                            <span class="font-medium">${activityTypesText.join(', ') || 'نامشخص'}</span>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateCustomerSelects() {
            const select = document.getElementById('customerSelect');
            if (select) {
                select.innerHTML = '<option value="">انتخاب کنید</option>';
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    select.appendChild(option);
                });
            }
        }

        function deleteCustomer(index) {
            if (confirm('آیا از حذف این مشتری اطمینان دارید؟')) {
                customers.splice(index, 1);
                updateCustomersList();
                updateCustomerSelects();
                showNotification('مشتری با موفقیت حذف شد', 'success');
            }
        }

        function updateAssignmentsTable() {
            const tbody = document.getElementById('assignmentsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            customerAssignments.forEach((assignment, index) => {
                const employee = employees.find(emp => emp.code === assignment.employeeCode);
                const customer = customers.find(cust => cust.id === assignment.customerId);
                
                if (employee && customer) {
                    const row = document.createElement('tr');
                    row.className = 'table-row hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${employee.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${customer.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${customer.type}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${customer.field}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${new Date(assignment.assignedAt).toLocaleDateString('fa-IR')}</td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="removeAssignment(${index})" class="text-red-600 hover:text-red-800 hover:bg-red-100 p-2 rounded-lg transition-all">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }

        function updateActivitiesTable() {
            const tbody = document.getElementById('activitiesTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            marketingActivities.forEach(activity => {
                const employee = employees.find(emp => emp.code === activity.employeeCode);
                const customer = customers.find(cust => cust.id === activity.customerId);
                
                if (employee && customer) {
                    const row = document.createElement('tr');
                    row.className = 'table-row hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${employee.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${customer.name}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${activity.type}</td>
                        <td class="px-4 py-3 text-sm text-gray-900">${new Date(activity.date).toLocaleDateString('fa-IR')}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 rounded-full text-xs ${
                                activity.status === 'تکمیل شده' ? 'bg-green-100 text-green-800' :
                                activity.status === 'در حال پیگیری' ? 'bg-blue-100 text-blue-800' :
                                'bg-yellow-100 text-yellow-800'
                            }">${activity.status}</span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900">${activity.details.substring(0, 50)}...</td>
                    `;
                    tbody.appendChild(row);
                }
            });
        }

        function assignCustomer() {
            const employeeCode = document.getElementById('marketingEmployeeSelect').value;
            const customerId = parseInt(document.getElementById('customerSelect').value);
            
            if (!employeeCode || !customerId) {
                showNotification('لطفاً کارمند و مشتری را انتخاب کنید', 'error');
                return;
            }
            
            // Check if already assigned
            const existingAssignment = customerAssignments.find(
                assignment => assignment.employeeCode === employeeCode && assignment.customerId === customerId
            );
            
            if (existingAssignment) {
                showNotification('این مشتری قبلاً به این کارمند تخصیص داده شده است', 'error');
                return;
            }
            
            customerAssignments.push({
                employeeCode: employeeCode,
                customerId: customerId,
                assignedAt: new Date(),
                id: Date.now()
            });
            
            updateAssignmentsTable();
            document.getElementById('marketingEmployeeSelect').value = '';
            document.getElementById('customerSelect').value = '';
            
            showNotification('مشتری با موفقیت تخصیص داده شد', 'success');
        }

        function removeAssignment(index) {
            if (confirm('آیا از حذف این تخصیص اطمینان دارید؟')) {
                customerAssignments.splice(index, 1);
                updateAssignmentsTable();
                showNotification('تخصیص با موفقیت حذف شد', 'success');
            }
        }

        // Marketing Progress Functions
        let currentProgressCustomer = null;
        let marketingProgressChart = null;

        function showMarketingProgress(customerIndex) {
            currentProgressCustomer = customers[customerIndex];
            document.getElementById('marketingProgressModal').style.display = 'flex';
            
            // Update customer info
            const customerInfo = document.getElementById('progressCustomerInfo');
            customerInfo.innerHTML = `
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6">
                    <div class="flex items-center space-x-4 space-x-reverse">
                        <div class="w-16 h-16 gradient-primary rounded-full flex items-center justify-center">
                            <i class="fas ${currentProgressCustomer.type === 'حقیقی' ? 'fa-user' : 'fa-building'} text-white text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold text-gray-800">${currentProgressCustomer.name}</h4>
                            <p class="text-gray-600">${currentProgressCustomer.type} - ${currentProgressCustomer.field}</p>
                            <div class="flex items-center space-x-4 space-x-reverse mt-2">
                                <span class="text-sm bg-blue-100 text-blue-800 px-3 py-1 rounded-full">سابقه: ${currentProgressCustomer.experience} سال</span>
                                <span class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full">اولویت: ${currentProgressCustomer.priority}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            updateMarketingStagesDisplay();
        }

        function hideMarketingProgressModal() {
            document.getElementById('marketingProgressModal').style.display = 'none';
            currentProgressCustomer = null;
        }

        function updateMarketingStagesDisplay() {
            if (!currentProgressCustomer) return;
            
            const container = document.getElementById('marketingStages');
            const stages = [
                { key: 'firstMeeting', name: 'اولین ملاقات حضوری', icon: 'fa-handshake' },
                { key: 'accountOpening', name: 'افتتاح انواع حساب', icon: 'fa-user-plus' },
                { key: 'resourceTransfer', name: 'انتقال منابع', icon: 'fa-exchange-alt' },
                { key: 'facilities', name: 'تسهیلات', icon: 'fa-credit-card' },
                { key: 'currencyActivities', name: 'فعالیت‌های ارزی', icon: 'fa-dollar-sign' },
                { key: 'businessExpansion', name: 'توسعه فعالیت‌ها', icon: 'fa-chart-line' },
                { key: 'modernServices', name: 'خدمات مدرن', icon: 'fa-laptop' },
                { key: 'welfareAgreement', name: 'تفاهم‌نامه رفاهی', icon: 'fa-file-contract' }
            ];
            
            container.innerHTML = '';
            
            stages.forEach(stage => {
                const progress = currentProgressCustomer.marketingProgress[stage.key];
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 rounded-xl transition-all ${
                    progress.progress > 0 ? 'bg-green-100 border-green-200' : 'bg-gray-100 border-gray-200'
                } border`;
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-8 h-8 ${progress.progress > 0 ? 'bg-green-500' : 'bg-gray-400'} rounded-full flex items-center justify-center">
                            <i class="fas ${stage.icon} text-white text-sm"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">${stage.name}</p>
                            ${progress.date ? `<p class="text-xs text-gray-600">${new Date(progress.date).toLocaleDateString('fa-IR')}</p>` : ''}
                        </div>
                    </div>
                    <div class="text-left">
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <span class="font-bold ${progress.progress >= 100 ? 'text-green-600' : progress.progress > 0 ? 'text-blue-600' : 'text-gray-400'}">${progress.progress}%</span>
                            ${progress.progress >= 100 ? '<i class="fas fa-check-circle text-green-500"></i>' : ''}
                        </div>
                        <div class="w-20 h-2 bg-gray-200 rounded-full mt-1">
                            <div class="h-full ${progress.progress >= 100 ? 'bg-green-500' : 'bg-blue-500'} rounded-full transition-all" style="width: ${progress.progress}%"></div>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function updateProgressValue() {
            const value = document.getElementById('progressSlider').value;
            document.getElementById('progressValue').textContent = value + '%';
        }

        function updateMarketingStage() {
            if (!currentProgressCustomer) return;
            
            const stage = document.getElementById('updateStageSelect').value;
            const progress = parseInt(document.getElementById('progressSlider').value);
            const date = document.getElementById('progressDate').value;
            const notes = document.getElementById('progressNotes').value;
            
            // Update customer progress
            currentProgressCustomer.marketingProgress[stage] = {
                progress: progress,
                date: date ? new Date(date) : null,
                notes: notes,
                completed: progress >= 100
            };
            
            // Update the customer in the array
            const customerIndex = customers.findIndex(c => c.id === currentProgressCustomer.id);
            if (customerIndex !== -1) {
                customers[customerIndex] = currentProgressCustomer;
            }
            
            updateMarketingStagesDisplay();
            updateCustomersList();
            
            // Reset form
            document.getElementById('progressSlider').value = 0;
            document.getElementById('progressDate').value = '';
            document.getElementById('progressNotes').value = '';
            document.getElementById('progressValue').textContent = '0%';
            
            showNotification('پیشرفت با موفقیت بروزرسانی شد', 'success');
        }

        function updateMarketingProgressChart() {
            const customerId = document.getElementById('progressCustomerSelect').value;
            if (!customerId) return;
            
            const customer = customers.find(c => c.id == customerId);
            if (!customer) return;
            
            const ctx = document.getElementById('marketingProgressChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (marketingProgressChart) {
                marketingProgressChart.destroy();
            }
            
            // Get marketing activities for this customer with dates
            const customerActivities = marketingActivities.filter(activity => activity.customerId == customerId);
            
            // Create timeline data points
            const timelineData = [];
            const activityLabels = [];
            
            // Add completed marketing stages with their dates
            const stages = [
                { key: 'firstMeeting', name: 'اولین ملاقات حضوری' },
                { key: 'accountOpening', name: 'افتتاح انواع حساب' },
                { key: 'resourceTransfer', name: 'انتقال منابع' },
                { key: 'facilities', name: 'تسهیلات' },
                { key: 'currencyActivities', name: 'فعالیت‌های ارزی' },
                { key: 'businessExpansion', name: 'توسعه فعالیت‌ها' },
                { key: 'modernServices', name: 'خدمات مدرن' },
                { key: 'welfareAgreement', name: 'تفاهم‌نامه رفاهی' }
            ];
            
            // Collect all activities with dates
            const allActivities = [];
            
            stages.forEach((stage, index) => {
                const progress = customer.marketingProgress[stage.key];
                if (progress.date && progress.progress > 0) {
                    allActivities.push({
                        date: new Date(progress.date),
                        name: stage.name,
                        progress: progress.progress,
                        notes: progress.notes,
                        stageIndex: index + 1
                    });
                }
            });
            
            // Add actual marketing activities
            customerActivities.forEach(activity => {
                allActivities.push({
                    date: new Date(activity.date),
                    name: activity.type,
                    progress: 50, // Default progress for activities
                    notes: activity.details,
                    stageIndex: allActivities.length + 1
                });
            });
            
            // Sort by date
            allActivities.sort((a, b) => a.date - b.date);
            
            // Prepare chart data
            const chartLabels = [];
            const chartData = [];
            
            allActivities.forEach((activity, index) => {
                chartLabels.push(activity.date.toLocaleDateString('fa-IR', { 
                    month: 'short', 
                    day: 'numeric' 
                }));
                chartData.push({
                    x: index,
                    y: activity.stageIndex,
                    activity: activity.name,
                    date: activity.date.toLocaleDateString('fa-IR'),
                    notes: activity.notes
                });
            });
            
            try {
                if (typeof Chart === 'undefined') {
                    console.log('❌ Chart.js not available for marketing progress chart');
                    ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-96 text-gray-500"><i class="fas fa-chart-line text-4xl"></i><span class="mr-3">نمودار در حال بارگذاری...</span></div>';
                    return;
                }
                
                marketingProgressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: 'فعالیت‌های بازاریابی',
                            data: chartData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3,
                            fill: false,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 3,
                            pointRadius: 8,
                            pointHoverRadius: 12
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: `تایم‌لاین فعالیت‌های بازاریابی - ${customer.name}`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        const dataPoint = context[0].raw;
                                        return `${dataPoint.activity}`;
                                    },
                                    label: function(context) {
                                        const dataPoint = context.raw;
                                        return [
                                            `تاریخ: ${dataPoint.date}`,
                                            `یادداشت: ${dataPoint.notes || 'ندارد'}`
                                        ];
                                    }
                                },
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#ffffff',
                                bodyColor: '#ffffff',
                                borderColor: '#667eea',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'تاریخ فعالیت‌ها',
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'مراحل بازاریابی',
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                min: 0,
                                max: 9,
                                ticks: {
                                    stepSize: 1,
                                    callback: function(value) {
                                        const stageNames = [
                                            '', 'ملاقات اول', 'افتتاح حساب', 'انتقال منابع', 
                                            'تسهیلات', 'فعالیت ارزی', 'توسعه کسب‌وکار', 
                                            'خدمات مدرن', 'تفاهم‌نامه'
                                        ];
                                        return stageNames[value] || '';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                }
                            }
                        },
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                });
                console.log('✅ Marketing timeline chart created successfully');
            } catch (error) {
                console.log('❌ Marketing timeline chart creation failed:', error.message);
                ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-96 text-gray-500"><i class="fas fa-exclamation-triangle text-4xl text-red-500"></i><span class="mr-3">خطا در بارگذاری نمودار</span></div>';
            }
        }

        function updateProgressCustomerSelect() {
            const select = document.getElementById('progressCustomerSelect');
            if (select) {
                select.innerHTML = '<option value="">انتخاب کنید</option>';
                customers.forEach(customer => {
                    const option = document.createElement('option');
                    option.value = customer.id;
                    option.textContent = customer.name;
                    select.appendChild(option);
                });
            }
        }

        // Add missing report functions
        function generateExcelReport() {
            showNotification('گزارش اکسل در حال تولید است...', 'info');
        }

        function generatePDFReport() {
            showNotification('گزارش PDF در حال تولید است...', 'info');
        }

        function showEmployeeAnalysis() {
            showNotification('تحلیل عملکرد در حال بارگذاری...', 'info');
        }

        function generateTimeReport() {
            showNotification('گزارش بازه زمانی در حال تولید...', 'info');
        }

        function generateMetricReport() {
            showNotification('گزارش شاخص‌ها در حال تولید...', 'info');
        }

        function exportDetailedReport(type) {
            showNotification(`گزارش ${type} در حال تولید...`, 'info');
        }

        // Add missing import functions
        function handleEmployeeImport(event) {
            showNotification('فایل کارمندان در حال پردازش...', 'info');
        }

        function handleGoalsImport(event) {
            showNotification('فایل اهداف در حال پردازش...', 'info');
        }

        // Password toggle function
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleIcon = document.getElementById('passwordToggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye';
            }
        }

        // Financial Ticker Functions
        function showTicker() {
            const ticker = document.getElementById('financialTicker');
            if (ticker) {
                ticker.style.display = 'block';
                // Adjust main content margin
                const adminDashboard = document.getElementById('adminDashboard');
                if (adminDashboard) {
                    adminDashboard.style.marginTop = '64px';
                }
            }
        }

        function hideTicker() {
            const ticker = document.getElementById('financialTicker');
            if (ticker) {
                ticker.style.display = 'none';
                // Reset main content margin
                const adminDashboard = document.getElementById('adminDashboard');
                if (adminDashboard) {
                    adminDashboard.style.marginTop = '0';
                }
            }
        }

        function toggleTicker() {
            const ticker = document.getElementById('financialTicker');
            const toggleIcon = document.getElementById('tickerToggleIcon');
            
            if (!ticker) return;
            
            tickerCollapsed = !tickerCollapsed;
            
            if (tickerCollapsed) {
                ticker.classList.add('ticker-collapsed');
                toggleIcon.className = 'fas fa-chevron-down text-white text-sm';
            } else {
                ticker.classList.remove('ticker-collapsed');
                toggleIcon.className = 'fas fa-chevron-up text-white text-sm';
            }
        }

        function initializeTicker() {
            updateTickerDisplay();
            updateTickerTime();
            
            // Update ticker time every second
            setInterval(updateTickerTime, 1000);
            
            // Simulate real-time updates every 30 seconds
            setInterval(simulateTickerUpdates, 30000);
        }

        function updateTickerTime() {
            const timeElement = document.getElementById('tickerTime');
            if (timeElement) {
                const now = new Date();
                const timeString = now.toLocaleTimeString('fa-IR', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                timeElement.textContent = timeString;
            }
        }

        function updateTickerDisplay() {
            // Update all ticker values
            for (let metric in tickerData) {
                const data = tickerData[metric];
                const valueElement = document.getElementById(`ticker${metric.charAt(0).toUpperCase() + metric.slice(1)}`);
                const changeElement = document.getElementById(`ticker${metric.charAt(0).toUpperCase() + metric.slice(1)}Change`);
                
                if (valueElement) {
                    valueElement.textContent = formatNumber(data.value);
                    valueElement.classList.add('ticker-number');
                }
                
                if (changeElement) {
                    const changeText = data.change > 0 ? `+${data.change}%` : `${data.change}%`;
                    changeElement.textContent = changeText;
                    
                    // Update arrow and color based on change
                    const arrow = changeElement.querySelector('i');
                    if (arrow) {
                        if (data.change > 0) {
                            arrow.className = 'fas fa-arrow-up mr-1';
                            changeElement.className = 'text-green-400 text-sm font-medium';
                        } else if (data.change < 0) {
                            arrow.className = 'fas fa-arrow-down mr-1';
                            changeElement.className = 'text-red-400 text-sm font-medium';
                        } else {
                            arrow.className = 'fas fa-minus mr-1';
                            changeElement.className = 'text-yellow-400 text-sm font-medium';
                        }
                    }
                }
            }
            
            // Update resource progress
            const progressElement = document.getElementById('tickerResourceProgress');
            if (progressElement && tickerData.resourceTarget.target) {
                const progress = (tickerData.dailyResources.value / tickerData.resourceTarget.target * 100).toFixed(1);
                progressElement.textContent = `${progress}%`;
            }
        }

        function formatNumber(num) {
            if (num >= 1000000000) {
                return (num / 1000000000).toFixed(1) + 'B';
            } else if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toLocaleString();
        }

        function simulateTickerUpdates() {
            // Simulate random changes in ticker values
            for (let metric in tickerData) {
                const data = tickerData[metric];
                const randomChange = (Math.random() - 0.5) * 10; // Random change between -5% and +5%
                const newValue = Math.max(0, data.value * (1 + randomChange / 100));
                
                tickerData[metric].value = Math.round(newValue);
                tickerData[metric].change = randomChange;
            }
            
            updateTickerDisplay();
            
            // Add glow effect during update
            const ticker = document.getElementById('financialTicker');
            if (ticker) {
                ticker.classList.add('ticker-glow');
                setTimeout(() => {
                    ticker.classList.remove('ticker-glow');
                }, 1000);
            }
        }

        function showTickerEditModal(metricKey) {
            if (!currentUser || currentUser.type !== 'admin') {
                showNotification('فقط مدیر سیستم می‌تواند شاخص‌ها را ویرایش کند', 'error');
                return;
            }
            
            currentTickerMetric = metricKey;
            const data = tickerData[metricKey];
            
            // Set modal title
            const titles = {
                dailyResources: 'منابع روز',
                resourceTarget: 'هدف منابع',
                profitLoss: 'سود و زیان',
                expenses: 'مصارف',
                claims: 'مطالبات',
                deposits: 'سپرده‌ها',
                facilities: 'تسهیلات'
            };
            
            document.getElementById('tickerModalTitle').textContent = `ویرایش ${titles[metricKey]}`;
            
            // Fill form with current data
            document.getElementById('tickerCurrentValue').value = data.value;
            document.getElementById('tickerChangePercent').value = data.change;
            
            // Show/hide target section
            const targetSection = document.getElementById('tickerTargetSection');
            if (metricKey === 'resourceTarget') {
                targetSection.classList.remove('hidden');
                document.getElementById('tickerTargetValue').value = data.target || '';
            } else {
                targetSection.classList.add('hidden');
            }
            
            document.getElementById('tickerEditModal').style.display = 'flex';
        }

        function hideTickerEditModal() {
            document.getElementById('tickerEditModal').style.display = 'none';
            document.getElementById('tickerEditForm').reset();
            currentTickerMetric = null;
        }

        // Ticker edit form handler
        document.getElementById('tickerEditForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentTickerMetric) return;
            
            const newValue = parseFloat(document.getElementById('tickerCurrentValue').value);
            const newChange = parseFloat(document.getElementById('tickerChangePercent').value) || 0;
            const newTarget = parseFloat(document.getElementById('tickerTargetValue').value) || null;
            
            // Update ticker data
            tickerData[currentTickerMetric].value = newValue;
            tickerData[currentTickerMetric].change = newChange;
            
            if (currentTickerMetric === 'resourceTarget' && newTarget) {
                tickerData[currentTickerMetric].target = newTarget;
            }
            
            // Update display with animation
            const valueElement = document.getElementById(`ticker${currentTickerMetric.charAt(0).toUpperCase() + currentTickerMetric.slice(1)}`);
            if (valueElement) {
                valueElement.classList.add('updating');
                setTimeout(() => {
                    valueElement.classList.remove('updating');
                }, 500);
            }
            
            updateTickerDisplay();
            hideTickerEditModal();
            
            showNotification('شاخص مالی با موفقیت بروزرسانی شد', 'success');
            
            // Add to realtime activities
            addRealtimeActivity({
                employee: 'مدیر سیستم',
                action: `بروزرسانی شاخص ${getTickerMetricName(currentTickerMetric)}`
            });
        });

        function getTickerMetricName(metricKey) {
            const names = {
                dailyResources: 'منابع روز',
                resourceTarget: 'هدف منابع',
                profitLoss: 'سود و زیان',
                expenses: 'مصارف',
                claims: 'مطالبات',
                deposits: 'سپرده‌ها',
                facilities: 'تسهیلات'
            };
            return names[metricKey] || metricKey;
        }

        // Employee Evaluation Functions
        function filterEmployeesForEvaluation() {
            const searchTerm = document.getElementById('employeeSearchEval').value.toLowerCase();
            const container = document.getElementById('employeeListForEvaluation');
            
            container.innerHTML = '';
            
            const filteredEmployees = employees.filter(emp => 
                emp.name.toLowerCase().includes(searchTerm) || 
                emp.code.toLowerCase().includes(searchTerm)
            );
            
            filteredEmployees.forEach(employee => {
                const div = document.createElement('div');
                div.className = `flex items-center justify-between p-3 rounded-xl border transition-all cursor-pointer hover:bg-blue-50 ${
                    selectedEmployeeForEvaluation && selectedEmployeeForEvaluation.code === employee.code 
                        ? 'bg-blue-100 border-blue-300' 
                        : 'bg-white border-gray-200'
                }`;
                div.onclick = () => selectEmployeeForEvaluation(employee);
                
                div.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-10 h-10 gradient-primary rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">${employee.name}</p>
                            <p class="text-sm text-gray-600">${employee.position}</p>
                            <p class="text-xs text-gray-500">کد: ${employee.code}</p>
                        </div>
                    </div>
                    <div class="text-blue-500">
                        <i class="fas fa-chevron-left"></i>
                    </div>
                `;
                
                container.appendChild(div);
            });
            
            if (filteredEmployees.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">کارمندی یافت نشد</p>';
            }
        }

        function selectEmployeeForEvaluation(employee) {
            selectedEmployeeForEvaluation = employee;
            
            // Update selected employee info
            const infoContainer = document.getElementById('selectedEmployeeInfo');
            infoContainer.innerHTML = `
                <div class="text-center">
                    <div class="w-16 h-16 gradient-primary rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user text-white text-2xl"></i>
                    </div>
                    <h4 class="text-lg font-bold text-gray-800 mb-2">${employee.name}</h4>
                    <p class="text-gray-600 mb-1">${employee.position}</p>
                    <p class="text-sm text-gray-500">کد پرسنلی: ${employee.code}</p>
                    <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-blue-50 rounded-lg p-3">
                            <p class="text-blue-600 font-medium">بخش</p>
                            <p class="text-gray-800">${getEmployeeDepartment(employee.code)}</p>
                        </div>
                        <div class="bg-green-50 rounded-lg p-3">
                            <p class="text-green-600 font-medium">تاریخ ورود</p>
                            <p class="text-gray-800">${new Date(employee.joinDate).toLocaleDateString('fa-IR')}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Enable action buttons
            const buttons = ['scoreBtn', 'warningBtn', 'messageBtn', 'taskBtn', 'feedbackBtn'];
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
            
            // Update employee list display
            filterEmployeesForEvaluation();
            updateEvaluationHistory();
        }

        // Modal Functions
        function showScoreModal() {
            if (!selectedEmployeeForEvaluation) return;
            
            document.getElementById('scoreModalEmployeeName').textContent = selectedEmployeeForEvaluation.name;
            document.getElementById('scoreModal').style.display = 'flex';
            
            // Reset form
            document.getElementById('scoreForm').reset();
            updateAllScoreValues();
        }

        function hideScoreModal() {
            document.getElementById('scoreModal').style.display = 'none';
        }

        function showWarningModal() {
            if (!selectedEmployeeForEvaluation) return;
            
            document.getElementById('warningModalEmployeeName').textContent = selectedEmployeeForEvaluation.name;
            document.getElementById('warningModal').style.display = 'flex';
            document.getElementById('warningForm').reset();
        }

        function hideWarningModal() {
            document.getElementById('warningModal').style.display = 'none';
        }

        function showMessageModal() {
            if (!selectedEmployeeForEvaluation) return;
            
            document.getElementById('messageModalEmployeeName').textContent = selectedEmployeeForEvaluation.name;
            document.getElementById('messageModal').style.display = 'flex';
            document.getElementById('messageForm').reset();
        }

        function hideMessageModal() {
            document.getElementById('messageModal').style.display = 'none';
        }

        function showTaskModal() {
            if (!selectedEmployeeForEvaluation) return;
            
            document.getElementById('taskModalEmployeeName').textContent = selectedEmployeeForEvaluation.name;
            document.getElementById('taskModal').style.display = 'flex';
            document.getElementById('taskForm').reset();
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            document.getElementById('taskStartDate').value = today;
            document.getElementById('taskDeadline').value = nextWeek;
        }

        function hideTaskModal() {
            document.getElementById('taskModal').style.display = 'none';
        }

        function showFeedbackModal() {
            if (!selectedEmployeeForEvaluation) return;
            
            document.getElementById('feedbackModalEmployeeName').textContent = selectedEmployeeForEvaluation.name;
            document.getElementById('feedbackModal').style.display = 'flex';
            document.getElementById('feedbackForm').reset();
        }

        function hideFeedbackModal() {
            document.getElementById('feedbackModal').style.display = 'none';
        }

        // Score Functions
        function updateScoreValue(type) {
            const score = document.getElementById(`${type}Score`).value;
            document.getElementById(`${type}Value`).textContent = score;
            updateAverageScore();
        }

        function updateAllScoreValues() {
            const types = ['quality', 'speed', 'attendance', 'teamwork'];
            types.forEach(type => {
                const score = document.getElementById(`${type}Score`).value;
                document.getElementById(`${type}Value`).textContent = score;
            });
            updateAverageScore();
        }

        function updateAverageScore() {
            const quality = parseInt(document.getElementById('qualityScore').value);
            const speed = parseInt(document.getElementById('speedScore').value);
            const attendance = parseInt(document.getElementById('attendanceScore').value);
            const teamwork = parseInt(document.getElementById('teamworkScore').value);
            
            const average = Math.round((quality + speed + attendance + teamwork) / 4);
            document.getElementById('averageScore').textContent = average;
        }

        // Form Handlers
        document.getElementById('scoreForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const evaluation = {
                id: Date.now(),
                employeeCode: selectedEmployeeForEvaluation.code,
                employeeName: selectedEmployeeForEvaluation.name,
                type: 'score',
                date: new Date(),
                scores: {
                    quality: parseInt(document.getElementById('qualityScore').value),
                    speed: parseInt(document.getElementById('speedScore').value),
                    attendance: parseInt(document.getElementById('attendanceScore').value),
                    teamwork: parseInt(document.getElementById('teamworkScore').value),
                    average: Math.round((
                        parseInt(document.getElementById('qualityScore').value) +
                        parseInt(document.getElementById('speedScore').value) +
                        parseInt(document.getElementById('attendanceScore').value) +
                        parseInt(document.getElementById('teamworkScore').value)
                    ) / 4)
                },
                qualitative: {
                    strengths: document.getElementById('strengths').value,
                    weaknesses: document.getElementById('weaknesses').value,
                    improvements: document.getElementById('improvements').value
                },
                period: {
                    type: document.getElementById('evaluationPeriod').value,
                    startDate: document.getElementById('evaluationStartDate').value,
                    endDate: document.getElementById('evaluationEndDate').value
                }
            };
            
            employeeEvaluations.push(evaluation);
            updateEvaluationHistory();
            updateEvaluationStats();
            hideScoreModal();
            
            showNotification(`ارزیابی ${selectedEmployeeForEvaluation.name} با موفقیت ثبت شد`, 'success');
            
            addRealtimeActivity({
                employee: 'مدیر سیستم',
                action: `ارزیابی عملکرد ${selectedEmployeeForEvaluation.name} - نمره: ${evaluation.scores.average}`
            });
        });

        document.getElementById('warningForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const warning = {
                id: Date.now(),
                employeeCode: selectedEmployeeForEvaluation.code,
                employeeName: selectedEmployeeForEvaluation.name,
                type: 'warning',
                date: new Date(),
                warningType: document.getElementById('warningType').value,
                subject: document.getElementById('warningSubject').value,
                description: document.getElementById('warningDescription').value,
                expectedActions: document.getElementById('expectedActions').value,
                deadline: parseInt(document.getElementById('correctionDeadline').value),
                priority: document.getElementById('warningPriority').value,
                status: 'sent'
            };
            
            employeeWarnings.push(warning);
            updateEvaluationHistory();
            updateEvaluationStats();
            hideWarningModal();
            
            showNotification(`تذکر برای ${selectedEmployeeForEvaluation.name} ارسال شد`, 'success');
            
            addRealtimeActivity({
                employee: 'مدیر سیستم',
                action: `ارسال تذکر ${warning.warningType} به ${selectedEmployeeForEvaluation.name}`
            });
        });

        document.getElementById('messageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const message = {
                id: Date.now(),
                employeeCode: selectedEmployeeForEvaluation.code,
                employeeName: selectedEmployeeForEvaluation.name,
                type: 'message',
                date: new Date(),
                messageType: document.getElementById('messageType').value,
                subject: document.getElementById('messageSubject').value,
                content: document.getElementById('messageContent').value,
                priority: document.getElementById('messagePriority').value,
                requiresResponse: document.getElementById('requiresResponse').value === 'yes',
                status: 'sent'
            };
            
            employeeMessages.push(message);
            updateEvaluationHistory();
            updateEvaluationStats();
            updateRecentMessages();
            hideMessageModal();
            
            showNotification(`پیام کاری برای ${selectedEmployeeForEvaluation.name} ارسال شد`, 'success');
            
            addRealtimeActivity({
                employee: 'مدیر سیستم',
                action: `ارسال پیام ${message.messageType} به ${selectedEmployeeForEvaluation.name}`
            });
        });

        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const task = {
                id: Date.now(),
                employeeCode: selectedEmployeeForEvaluation.code,
                employeeName: selectedEmployeeForEvaluation.name,
                type: 'task',
                date: new Date(),
                title: document.getElementById('taskTitle').value,
                taskType: document.getElementById('taskType').value,
                description: document.getElementById('taskDescription').value,
                startDate: document.getElementById('taskStartDate').value,
                deadline: document.getElementById('taskDeadline').value,
                priority: document.getElementById('taskPriority').value,
                criteria: document.getElementById('taskCriteria').value,
                estimatedHours: parseInt(document.getElementById('estimatedHours').value) || 0,
                requiresProgress: document.getElementById('requiresProgress').value,
                status: 'assigned',
                progress: 0
            };
            
            employeeTasks.push(task);
            updateEvaluationHistory();
            updateEvaluationStats();
            updateActiveTasks();
            hideTaskModal();
            
            showNotification(`وظیفه "${task.title}" برای ${selectedEmployeeForEvaluation.name} تعریف شد`, 'success');
            
            addRealtimeActivity({
                employee: 'مدیر سیستم',
                action: `تعریف وظیفه ${task.taskType} برای ${selectedEmployeeForEvaluation.name}`
            });
        });

        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const feedback = {
                id: Date.now(),
                employeeCode: selectedEmployeeForEvaluation.code,
                employeeName: selectedEmployeeForEvaluation.name,
                type: 'feedback',
                date: new Date(),
                feedbackType: document.getElementById('feedbackType').value,
                subject: document.getElementById('feedbackSubject').value,
                questions: document.getElementById('feedbackQuestions').value,
                deadline: parseInt(document.getElementById('feedbackDeadline').value),
                responseType: document.getElementById('responseType').value,
                status: 'pending',
                response: null
            };
            
            employeeFeedbacks.push(feedback);
            updateEvaluationHistory();
            updateEvaluationStats();
            hideFeedbackModal();
            
            showNotification(`درخواست بازخورد برای ${selectedEmployeeForEvaluation.name} ارسال شد`, 'success');
            
            addRealtimeActivity({
                employee: 'مدیر سیستم',
                action: `درخواست بازخورد ${feedback.feedbackType} از ${selectedEmployeeForEvaluation.name}`
            });
        });

        function updateEvaluationHistory() {
            const tbody = document.getElementById('evaluationHistoryTable');
            tbody.innerHTML = '';
            
            // Combine all evaluation data
            const allEvaluations = [
                ...employeeEvaluations.map(e => ({...e, displayType: 'نمره‌دهی', status: `${e.scores.average}/100`})),
                ...employeeWarnings.map(w => ({...w, displayType: 'تذکر', status: w.warningType})),
                ...employeeMessages.map(m => ({...m, displayType: 'پیام کاری', status: m.messageType})),
                ...employeeTasks.map(t => ({...t, displayType: 'وظیفه', status: t.status})),
                ...employeeFeedbacks.map(f => ({...f, displayType: 'بازخورد', status: f.status}))
            ];
            
            // Sort by date (newest first)
            allEvaluations.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (allEvaluations.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                            <i class="fas fa-clipboard-list text-4xl text-gray-300 mb-4"></i>
                            <p>هیچ ارزیابی ثبت نشده است</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            allEvaluations.forEach(evaluation => {
                const row = document.createElement('tr');
                row.className = 'table-row hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50';
                
                const statusBadge = getEvaluationStatusBadge(evaluation.type, evaluation.status);
                const description = getEvaluationDescription(evaluation);
                
                row.innerHTML = `
                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${evaluation.employeeName}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${evaluation.displayType}</td>
                    <td class="px-6 py-4 text-sm">${statusBadge}</td>
                    <td class="px-6 py-4 text-sm text-gray-900">${new Date(evaluation.date).toLocaleDateString('fa-IR')}</td>
                    <td class="px-6 py-4 text-sm text-gray-600">${description}</td>
                    <td class="px-6 py-4 text-center">
                        <button onclick="viewEvaluationDetails(${evaluation.id}, '${evaluation.type}')" class="text-blue-600 hover:text-blue-800 hover:bg-blue-100 p-2 rounded-lg transition-all">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function getEvaluationStatusBadge(type, status) {
            let badgeClass = 'px-3 py-1 rounded-full text-sm font-medium';
            
            switch(type) {
                case 'score':
                    const score = parseInt(status.split('/')[0]);
                    if (score >= 80) badgeClass += ' bg-green-100 text-green-800';
                    else if (score >= 60) badgeClass += ' bg-yellow-100 text-yellow-800';
                    else badgeClass += ' bg-red-100 text-red-800';
                    break;
                case 'warning':
                    badgeClass += ' bg-red-100 text-red-800';
                    break;
                case 'message':
                    badgeClass += ' bg-blue-100 text-blue-800';
                    break;
                case 'task':
                    if (status === 'completed') badgeClass += ' bg-green-100 text-green-800';
                    else if (status === 'in_progress') badgeClass += ' bg-yellow-100 text-yellow-800';
                    else badgeClass += ' bg-gray-100 text-gray-800';
                    break;
                case 'feedback':
                    if (status === 'completed') badgeClass += ' bg-green-100 text-green-800';
                    else badgeClass += ' bg-orange-100 text-orange-800';
                    break;
            }
            
            return `<span class="${badgeClass}">${status}</span>`;
        }

        function getEvaluationDescription(evaluation) {
            switch(evaluation.type) {
                case 'score':
                    return `ارزیابی ${evaluation.period.type} - میانگین: ${evaluation.scores.average}`;
                case 'warning':
                    return evaluation.subject;
                case 'message':
                    return evaluation.subject;
                case 'task':
                    return evaluation.title;
                case 'feedback':
                    return evaluation.subject;
                default:
                    return '-';
            }
        }

        function updateEvaluationStats() {
            document.getElementById('totalEvaluations').textContent = employeeEvaluations.length;
            document.getElementById('activeTasks').textContent = employeeTasks.filter(t => t.status !== 'completed').length;
            document.getElementById('totalWarnings').textContent = employeeWarnings.length;
            document.getElementById('totalMessages').textContent = employeeMessages.length;
            
            // Today's evaluations
            const today = new Date().toDateString();
            const todayEvaluations = employeeEvaluations.filter(e => new Date(e.date).toDateString() === today).length;
            document.getElementById('todayEvaluationsCount').textContent = todayEvaluations;
        }

        function updateActiveTasks() {
            const container = document.getElementById('activeTasksList');
            const activeTasks = employeeTasks.filter(t => t.status !== 'completed');
            
            container.innerHTML = '';
            
            if (activeTasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-tasks text-4xl text-gray-300 mb-4"></i>
                        <p>هیچ وظیفه فعالی وجود ندارد</p>
                    </div>
                `;
                return;
            }
            
            activeTasks.forEach(task => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl p-4 border border-gray-200 hover:border-purple-300 transition-all';
                
                const priorityColor = {
                    'low': 'text-gray-600',
                    'medium': 'text-yellow-600',
                    'high': 'text-orange-600',
                    'critical': 'text-red-600'
                };
                
                const daysLeft = Math.ceil((new Date(task.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                
                div.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h5 class="font-bold text-gray-800">${task.title}</h5>
                        <span class="text-xs ${priorityColor[task.priority]} font-medium">${task.priority}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${task.employeeName}</p>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>مهلت: ${daysLeft} روز</span>
                        <span>${task.taskType}</span>
                    </div>
                `;
                
                container.appendChild(div);
            });
            
            document.getElementById('activeTasksCount').textContent = activeTasks.length;
        }

        function updateRecentMessages() {
            const container = document.getElementById('recentMessagesList');
            const recentMessages = employeeMessages.slice(-5).reverse();
            
            container.innerHTML = '';
            
            if (recentMessages.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-envelope text-4xl text-gray-300 mb-4"></i>
                        <p>هیچ پیامی ارسال نشده است</p>
                    </div>
                `;
                return;
            }
            
            recentMessages.forEach(message => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl p-4 border border-gray-200 hover:border-green-300 transition-all';
                
                const priorityColor = {
                    'normal': 'text-gray-600',
                    'high': 'text-orange-600',
                    'urgent': 'text-red-600'
                };
                
                div.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <h5 class="font-bold text-gray-800">${message.subject}</h5>
                        <span class="text-xs ${priorityColor[message.priority]} font-medium">${message.priority}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${message.employeeName}</p>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>${new Date(message.date).toLocaleDateString('fa-IR')}</span>
                        <span>${message.messageType}</span>
                    </div>
                `;
                
                container.appendChild(div);
            });
            
            document.getElementById('recentMessagesCount').textContent = employeeMessages.length;
        }

        function viewEvaluationDetails(id, type) {
            // This function would show detailed view of evaluation
            showNotification('نمایش جزئیات ارزیابی', 'info');
        }

        // Initialize evaluation section when showing
        function initializeEvaluationSection() {
            filterEmployeesForEvaluation();
            updateEvaluationStats();
            updateActiveTasks();
            updateRecentMessages();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972fe84a402fdbd2',t:'MTc1NTgzOTg4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script src="app.js"></script>
</body>
</html>
